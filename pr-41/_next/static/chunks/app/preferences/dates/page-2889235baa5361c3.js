(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{266:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),r=s(2115),n=s(4110),l=s(285),i=s(6695);function d(e){let{selectedDates:t,onDatesChange:s,onStartSorting:n,holidayData:d={}}=e,[c,o]=(0,r.useState)(""),m=e=>{let a=new Date;if(a.setHours(0,0,0,0),e<a)return;let r=e.toISOString().split("T")[0];t.map(e=>e.toISOString().split("T")[0]).includes(r)||s([...t,e])},h=e=>{s(t.filter(t=>t.toISOString()!==e.toISOString()))},u=e=>{let t=d[e.toISOString().split("T")[0]];return t?"".concat(t," (").concat(e.toLocaleDateString(),")"):e.toLocaleDateString()},x=[{date:new Date("2024-12-25"),label:"Christmas Day"},{date:new Date("2024-01-01"),label:"New Year's Day"},{date:new Date("2024-07-04"),label:"Independence Day"},{date:new Date("2024-11-28"),label:"Thanksgiving"},{date:new Date("2024-10-31"),label:"Halloween"},{date:new Date("2024-02-14"),label:"Valentine's Day"}].filter(e=>{let t=new Date;return t.setHours(0,0,0,0),e.date>=t});return(0,a.jsxs)(i.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"Select Important Dates"}),(0,a.jsx)(i.BT,{children:"Choose the dates that are most important to you for having your child. You'll then sort them by priority."})]}),(0,a.jsxs)(i.Wu,{className:"space-y-6",children:[t.length>0&&(0,a.jsxs)("div",{"data-testid":"selected-dates",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium mb-2",children:["Selected Dates (",t.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{"data-testid":"selected-".concat(e.toISOString()),className:"flex items-center justify-between p-2 bg-blue-50 rounded-md",children:[(0,a.jsx)("span",{className:"text-sm",children:u(e)}),(0,a.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>h(e),className:"text-red-600 hover:text-red-800",children:"Remove"})]},e.toISOString()))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Common Important Dates"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:x.map(e=>{let s=t.some(t=>t.toISOString().split("T")[0]===e.date.toISOString().split("T")[0]);return(0,a.jsx)(l.$,{variant:s?"secondary":"outline",size:"sm",onClick:()=>m(e.date),disabled:s,className:"text-xs",children:e.label},e.date.toISOString())})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Add Custom Date"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"date",value:c,onChange:e=>o(e.target.value),min:new Date().toISOString().split("T")[0],className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,a.jsx)(l.$,{onClick:()=>{c&&(m(new Date(c)),o(""))},disabled:!c,size:"sm",children:"Add Date"})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t",children:[(0,a.jsx)(l.$,{"data-testid":"start-sorting",onClick:n,disabled:t.length<2,className:"w-full",size:"lg",children:t.length<2?"Select at least 2 dates to start sorting (".concat(t.length,"/2)"):"Start Sorting ".concat(t.length," Dates")}),t.length>=2&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2 text-center",children:"You'll compare dates to determine which are most important to you"})]})]})]})}var c=s(2099);function o(e){let{relationshipId:t,currentUserId:s,selectedDates:l=[],existingPreferences:i=[],holidayData:o={}}=e,[m,h]=(0,r.useState)(l),[u,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),j=(0,c.k)(),S=e=>{let t=new Date;return t.setHours(0,0,0,0),e.filter(e=>{let s=new Date(e);return s.setHours(0,0,0,0),s>=t})},f=async e=>{g(!0),y(null);try{let a=e.map((e,a)=>({relationshipId:t,userId:s,date:e.id,priority:a+1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})),{error:r}=await j.from("date_preferences").upsert(a);if(r)throw r;x(!1)}catch(e){y("Error saving preferences. Please try again."),console.error("Error saving date preferences:",e)}finally{g(!1)}},v=()=>{x(!1)};if(u){let e=(e=>{let t=S(e).map(e=>{let t=e.toISOString().split("T")[0],s=o[t];return{id:t,label:s||e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),description:s?e.toLocaleDateString():void 0,metadata:{date:t,isHoliday:!!s}}});if(i.length>0){let e=new Map(i.map(e=>[e.date,e.priority]));t.sort((t,s)=>(e.get(t.id)||999)-(e.get(s.id)||999))}return t})(m);return e.length<2?(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"No Future Dates to Sort"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"All selected dates are in the past. Please select future dates to sort."}),(0,a.jsx)("button",{onClick:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Back to Date Selection"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[b&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:b}),(0,a.jsx)(n.S,{items:e,onSortComplete:f,title:"Sort Your Date Preferences",description:"Compare pairs of dates to determine which are most important to you for having your child."}),p&&(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsxs)("div",{className:"inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving preferences..."]})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:v,className:"text-blue-600 hover:text-blue-800 text-sm",disabled:p,children:"â† Back to Date Selection"})})]})}return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Date Preference Sorting"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Select important dates and sort them by priority to help with custody scheduling."})]}),(0,a.jsx)(d,{selectedDates:m,onDatesChange:h,onStartSorting:()=>{x(!0)},holidayData:o}),i.length>0&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Your Current Preferences"}),(0,a.jsx)("div",{className:"space-y-1",children:i.sort((e,t)=>e.priority-t.priority).map((e,t)=>{let s=o[e.date],r=new Date(e.date),n=s||r.toLocaleDateString();return(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[t+1,". ",n]},e.date)})})]})]})}function m(){let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)({}),[l,i]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),h=(0,c.k)(),u="rel-123",x="user-123";(0,r.useEffect)(()=>{p(),g()},[]);let p=async()=>{try{let{data:e,error:s}=await h.from("date_preferences").select("*").eq("relationshipId",u).eq("userId",x).order("priority",{ascending:!0});if(s)throw s;t(e||[])}catch(e){console.error("Error loading existing preferences:",e),m("Failed to load existing preferences")}},g=async()=>{n({"2024-01-01":"New Year's Day","2024-02-14":"Valentine's Day","2024-03-17":"St. Patrick's Day","2024-04-01":"Easter","2024-05-12":"Mother's Day","2024-06-16":"Father's Day","2024-07-04":"Independence Day","2024-09-02":"Labor Day","2024-10-31":"Halloween","2024-11-28":"Thanksgiving","2024-12-25":"Christmas Day","2024-12-31":"New Year's Eve","2025-01-01":"New Year's Day","2025-02-14":"Valentine's Day","2025-03-17":"St. Patrick's Day","2025-04-20":"Easter","2025-05-11":"Mother's Day","2025-06-15":"Father's Day","2025-07-04":"Independence Day","2025-09-01":"Labor Day","2025-10-31":"Halloween","2025-11-27":"Thanksgiving","2025-12-25":"Christmas Day","2025-12-31":"New Year's Eve"}),i(!1)};return l?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading your date preferences..."})]})}):d?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-md",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Error Loading Preferences"}),(0,a.jsx)("p",{children:d}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Try Again"})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,a.jsx)(o,{relationshipId:u,currentUserId:x,selectedDates:e.map(e=>new Date(e.date)),existingPreferences:e,holidayData:s})})})}},2099:(e,t,s)=>{"use strict";s.d(t,{H:()=>l,k:()=>n});var a=s(4982),r=s(9509);let n=()=>{let e="https://gjgldkinpnckfwzwdbmt.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqZ2xka2lucG5ja2Z3endkYm10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0OTczMDYsImV4cCI6MjA2NzA3MzMwNn0.5ZQourcUdjk19MWjLQ9O0VhcHJj09YPzcxbN35MfMtQ";return e&&t?(0,a.UU)(e,t):(console.warn("Supabase environment variables not found, using fallback values for static generation"),(0,a.UU)("https://placeholder.supabase.co","placeholder-anon-key"))},l=()=>{let e="https://gjgldkinpnckfwzwdbmt.supabase.co",t=r.env.SUPABASE_SERVICE_ROLE_KEY;return e&&t?(0,a.UU)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}}):(console.warn("Supabase service role environment variables not found, using fallback values for static generation"),(0,a.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}}))}},2706:(e,t,s)=>{Promise.resolve().then(s.bind(s,266))}},e=>{var t=t=>e(e.s=t);e.O(0,[212,982,796,110,441,684,358],()=>t(2706)),_N_E=e.O()}]);