(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[581],{844:(e,t,r)=>{"use strict";r.d(t,{GY:()=>i,h9:()=>l,hV:()=>d});var s=r(9509);function n(){let e=a();return"main"===e||"master"===e||"production"===e?"production":"development"}function a(){return"copilot/fix-79"}function l(){if("production"===n())return{url:s.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",anonKey:s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-anon-key",serviceRoleKey:s.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};{let e=s.env.SUPABASE_DEV_URL||"https://bqiapoplmkkrtnsmmxhs.supabase.co";return{url:e,anonKey:s.env.SUPABASE_DEV_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDA3OTMsImV4cCI6MjA2ODAxNjc5M30.bZGNGvb8XYZSWkbfMYMNBAzoedp4SGOIerHmNcRqUsk",serviceRoleKey:s.env.SUPABASE_DEV_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjQ0MDc5MywiZXhwIjoyMDY4MDE2NzkzfQ.7m9y2vqrq1Sd8bX6dl6A47WQbZoQHGKc7o2rzrcTjKI"}}}function d(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&e.url.includes("supabase.co")}function i(){let e=a(),t=n(),r=l(),s=d(r);return{currentBranch:e,environment:t,supabaseUrl:r.url,hasValidConfig:s,configSource:"production"===t?"production":"development-default"}}},2099:(e,t,r)=>{"use strict";r.d(t,{H:()=>d,k:()=>l});var s=r(4982),n=r(844);let a=null,l=()=>{if(a)return a;let e=(0,n.h9)();return a=(0,n.hV)(e)?(0,s.UU)(e.url,e.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}}):(0,s.UU)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}})},d=()=>{let e=(0,n.h9)();return(0,n.hV)(e)&&e.serviceRoleKey&&"placeholder-service-role-key"!==e.serviceRoleKey?(0,s.UU)(e.url,e.serviceRoleKey,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,s.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}})}},4778:(e,t,r)=>{Promise.resolve().then(r.bind(r,6739))},6739:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),n=r(2115),a=r(4110),l=r(2099);let d=["7:00","8:00","9:00","12:00","15:00","16:00","17:00","18:00","19:00","20:00"],i=["8:00","9:00","10:00","11:00","12:00","14:00","16:00","17:00","18:00","19:00","20:00"],o={"7:00":"Early morning","8:00":"Before school/work","9:00":"Morning","12:00":"Lunch time","15:00":"After school","16:00":"Late afternoon","17:00":"Before dinner","18:00":"Dinner time","19:00":"After dinner","20:00":"Evening","21:00":"Late evening"};function c(e){let{relationshipId:t,currentUserId:r,dayType:c,existingPreferences:m=[],timeSlots:u,onPreferencesUpdated:h}=e,[p,f]=(0,n.useState)(!1),[x,b]=(0,n.useState)(null),[y,g]=(0,n.useState)(!1),[N,v]=(0,n.useState)([]),j=(0,l.k)(),k=u||("weekday"===c?d:i);(0,n.useEffect)(()=>{v(m.filter(e=>e.dayType===c).map(e=>e.time))},[m,c]);let w=e=>{let[t,r]=e.split(":"),s=parseInt(t);return"".concat(0===s?12:s>12?s-12:s,":").concat(r," ").concat(s>=12?"PM":"AM")},S=e=>o[e]||"",I=(e,t)=>{t?v(t=>[...t,e]):v(t=>t.filter(t=>t!==e))},E=async e=>{f(!0),b(null);try{let s=e.map((e,s)=>({relationshipId:t,userId:r,time:e.id,dayType:c,priority:s+1,context:S(e.id)}));await j.from("handoff_time_preferences").delete().eq("relationshipId",t).eq("userId",r).eq("dayType",c);let{error:n}=await j.from("handoff_time_preferences").insert(s);if(n)throw n;if(h){let e=s.map((e,t)=>({...e,id:"temp-".concat(t),createdAt:new Date,updatedAt:new Date}));h(e)}g(!1)}catch(e){b("Error saving handoff time preferences. Please try again."),console.error("Error saving handoff time preferences:",e)}finally{f(!1)}};if(y){let e=(()=>{let e=m.filter(e=>e.dayType===c).reduce((e,t)=>(e[t.time]=t,e),{});return N.sort((t,r)=>{let s=e[t],n=e[r];return s&&n?s.priority-n.priority:s?-1:n?1:t.localeCompare(r)}).map(e=>({id:e,label:w(e),description:S(e),metadata:{time:e,dayType:c}}))})();return(0,s.jsxs)("div",{className:"space-y-4",children:[p&&(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,s.jsx)("p",{className:"text-blue-800",children:"Saving your preferences..."})}),x&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,s.jsx)("p",{className:"text-red-800",children:x})}),(0,s.jsx)("button",{onClick:()=>{g(!1),b(null)},className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center",disabled:p,children:"← Back to Time Selection"}),(0,s.jsx)(a.S,{items:e,onSortComplete:E,title:"Sort Your ".concat("weekday"===c?"Weekday":"Weekend"," Handoff Time Preferences"),description:"Choose which handoff time you prefer when given the option. Your most preferred time will be ranked first."})]})}return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["weekday"===c?"Weekday":"Weekend"," Handoff Time Preferences"]}),(0,s.jsx)("p",{className:"text-gray-600",children:"Select your preferred handoff times and sort them by preference to help with custody scheduling."})]}),x&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,s.jsx)("p",{className:"text-red-800",children:x})}),(0,s.jsxs)("div",{"data-testid":"time-selector",className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Select Preferred Handoff Times"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:k.map(e=>(0,s.jsxs)("label",{className:"\n                flex items-center space-x-2 p-3 rounded-lg border cursor-pointer transition-colors\n                ".concat(N.includes(e)?"bg-blue-50 border-blue-300 text-blue-900":"bg-white border-gray-200 hover:bg-gray-50","\n              "),children:[(0,s.jsx)("input",{type:"checkbox",checked:N.includes(e),onChange:t=>I(e,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","data-testid":"time-".concat(e)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium",children:w(e)}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:S(e)})]})]},e))}),(0,s.jsxs)("div",{"data-testid":"selected-times",className:"mt-4",children:[(0,s.jsxs)("h3",{className:"text-md font-medium mb-2",children:["Selected Times (",N.length,")"]}),N.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>(0,s.jsxs)("span",{"data-testid":"selected-".concat(e),className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[w(e),(0,s.jsx)("button",{onClick:()=>I(e,!1),className:"ml-2 text-blue-600 hover:text-blue-800","aria-label":"Remove ".concat(w(e)),children:"\xd7"})]},e))}):(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No times selected"})]}),(0,s.jsx)("button",{onClick:()=>{if(N.length<2)return void b("Please select at least 2 handoff times to sort.");g(!0),b(null)},disabled:N.length<2||p,"data-testid":"start-sorting",className:"\n            w-full py-3 px-4 rounded-md font-medium transition-colors\n            ".concat(N.length>=2&&!p?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n          "),children:p?"Saving...":"Start Sorting Preferences"}),N.length<2&&(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Select at least 2 handoff times to enable sorting"})]})]})}function m(){let[e,t]=(0,n.useState)("weekday"),[r,a]=(0,n.useState)([]),[d,i]=(0,n.useState)(!0),[o,m]=(0,n.useState)(null),u="demo-relationship-123",h="demo-user-123",p=(0,l.k)();(0,n.useEffect)(()=>{f()},[]);let f=async()=>{try{i(!0);let{data:e,error:t}=await p.from("handoff_time_preferences").select("*").eq("relationshipId",u).eq("userId",h);t?(console.warn("Could not load preferences (demo mode):",t),a([])):a(e||[])}catch(e){console.warn("Could not load preferences (demo mode):",e),a([])}finally{i(!1)}},x=e=>r.filter(t=>t.dayType===e);return d?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading your preferences..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Handoff Time Preferences"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Set your preferred handoff times for weekdays and weekends to help with custody scheduling."})]}),o&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:(0,s.jsx)("p",{className:"text-red-800",children:o})}),(0,s.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg mb-8",children:[(0,s.jsxs)("button",{onClick:()=>t("weekday"),className:"\n                flex-1 py-2 px-4 rounded-md font-medium transition-colors\n                ".concat("weekday"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900","\n              "),"data-testid":"weekday-tab",children:["Weekdays",x("weekday").length>0&&(0,s.jsx)("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full",children:x("weekday").length})]}),(0,s.jsxs)("button",{onClick:()=>t("weekend"),className:"\n                flex-1 py-2 px-4 rounded-md font-medium transition-colors\n                ".concat("weekend"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900","\n              "),"data-testid":"weekend-tab",children:["Weekends",x("weekend").length>0&&(0,s.jsx)("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full",children:x("weekend").length})]})]}),(0,s.jsx)("div",{"data-testid":"".concat(e,"-content"),children:(0,s.jsx)(c,{relationshipId:u,currentUserId:h,dayType:e,existingPreferences:x(e),onPreferencesUpdated:t=>{a(r=>[...r.filter(t=>t.dayType!==e),...t])}})})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[277,982,804,796,110,441,684,358],()=>t(4778)),_N_E=e.O()}]);