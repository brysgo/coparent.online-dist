"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3030],{3030:(e,t,a)=>{a.r(t),a.d(t,{ExpenseBalance:()=>l});var r=a(5155),i=a(2115),s=a(3715),n=a(3579),o=a(3793);function l(){let{user:e}=(0,s.As)(),[t,a]=(0,i.useState)(null),[l,d]=(0,i.useState)(!0),[c,u]=(0,i.useState)(null),[m,_]=(0,i.useState)(!1),x=(0,i.useMemo)(()=>{if((0,o.HP)())return null;try{return(0,n.createClientComponentClient)()}catch(e){return console.warn("Failed to create Supabase client, falling back to demo mode:",e),_(!0),null}},[]);if((0,i.useEffect)(()=>{async function t(){if((0,o.HP)()||m){_(!0),a((0,o._g)()),d(!1);return}if(!e)return void d(!1);try{let{data:t,error:r}=await x.from("co_parent_relationships").select("id").or("parent_a_id.eq.".concat(e.id,",parent_b_id.eq.").concat(e.id)).limit(1);if(r)throw r;if(!t||0===t.length){a({who_owes:null,who_owes_id:null,owes_to:null,owes_to_id:null,amount:0}),d(!1);return}let i=t[0].id,{data:s,error:n}=await x.rpc("get_balance",{family_id:i});if(n)throw n;a(s)}catch(e){console.error("Error fetching balance:",e),u(e instanceof Error?e.message:"Failed to load balance")}finally{d(!1)}}if(t(),!(0,o.HP)()&&!m&&x){let e=x.channel("expense_changes").on("postgres_changes",{event:"*",schema:"public",table:"shared_expenses"},()=>{t()}).subscribe();return()=>{e.unsubscribe()}}},[e,x]),l)return(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]});if(c)return(0,r.jsxs)("div",{className:"text-red-600 dark:text-red-400",children:["Error loading balance: ",c]});if(!t)return(0,r.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:"No expense data available"});if(0===t.amount)return(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:"$0.00"}),(0,r.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:"All expenses are settled up! \uD83C\uDF89"}),m&&(0,r.jsx)("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:"\uD83D\uDCCA Demo Mode - Sample data"})]});let f=m?(0,o.iQ)():e,h=t.who_owes_id===(null==f?void 0:f.id);return(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold ".concat(h?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"),children:["$",t.amount.toFixed(2)]}),(0,r.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:h?(0,r.jsxs)(r.Fragment,{children:["You owe ",(0,r.jsx)("span",{className:"font-medium",children:t.owes_to})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-medium",children:t.who_owes})," owes you"]})}),m&&(0,r.jsx)("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:"\uD83D\uDCCA Demo Mode - Sample data"})]})}},3793:(e,t,a)=>{a.d(t,{HP:()=>n,Ti:()=>i,_5:()=>r,_g:()=>s,iQ:()=>o});let r=[{id:"user-1",full_name:"Alex Johnson",email:"alex@example.com"},{id:"user-2",full_name:"Jordan Smith",email:"jordan@example.com"}],i=[{id:"1",amount:75,description:"Soccer cleats for Emma",category:"Sports & Activities",expense_date:"2024-01-15",paid_by:"user-1",split_method:"fifty_fifty",reimbursed:!1,family_id:"family-1",created_at:"2024-01-15T10:30:00Z"},{id:"2",amount:120,description:"Pediatric dentist appointment",category:"Healthcare",expense_date:"2024-01-12",paid_by:"user-2",split_method:"fifty_fifty",reimbursed:!0,family_id:"family-1",created_at:"2024-01-12T14:15:00Z"},{id:"3",amount:89.99,description:"Winter jacket",category:"Clothing",expense_date:"2024-01-10",paid_by:"user-1",split_method:"fifty_fifty",reimbursed:!0,family_id:"family-1",created_at:"2024-01-10T16:45:00Z"},{id:"4",amount:45.5,description:"School lunch program",category:"Education",expense_date:"2024-01-08",paid_by:"user-2",split_method:"fifty_fifty",reimbursed:!1,family_id:"family-1",created_at:"2024-01-08T09:20:00Z"}];function s(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=0,t=0;i.forEach(a=>{if(!a.reimbursed){let r=a.amount/2;"user-1"===a.paid_by?e+=r:t+=r}});let a=Math.abs(e-t);return e>t?{who_owes:"Jordan Smith",who_owes_id:"user-2",owes_to:"Alex Johnson",owes_to_id:"user-1",amount:a}:t>e?{who_owes:"Alex Johnson",who_owes_id:"user-1",owes_to:"Jordan Smith",owes_to_id:"user-2",amount:a}:{who_owes:null,who_owes_id:null,owes_to:null,owes_to_id:null,amount:0}}function n(){return!0}function o(){return r[0]}}}]);