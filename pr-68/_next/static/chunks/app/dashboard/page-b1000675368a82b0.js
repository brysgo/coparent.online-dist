(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{2523:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(5155),r=s(2115),i=s(9434);let n=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","border-gray-300 bg-white placeholder:text-gray-400 focus-visible:ring-blue-500",s),ref:t,...n})});n.displayName="Input"},5057:(e,t,s)=>{"use strict";s.d(t,{J:()=>n});var a=s(5155),r=s(2115),i=s(9434);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("label",{ref:t,className:(0,i.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70","text-gray-700",s),...r})});n.displayName="Label"},6952:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var a=s(5155),r=s(3715),i=s(2115),n=s(5695),l=s(6874),d=s.n(l),c=s(285),x=s(6695),o=s(2523),h=s(5057),m=s(8539),u=s(9657),g=s(3579),p=s(2099);function j(e){let{onSuccess:t}=e,[s,r]=(0,i.useState)(""),[n,l]=(0,i.useState)([]),[d,j]=(0,i.useState)(""),[f,y]=(0,i.useState)([]),[b,v]=(0,i.useState)(!0),{sendBulkInvitation:N,loading:w,error:_,clearError:k}=(0,u._)(),S=(()=>{try{return(0,g.createClientComponentClient)()}catch(e){return(0,p.k)()}})();(0,i.useEffect)(()=>{C()},[]),(0,i.useEffect)(()=>{if(_){let e=setTimeout(()=>{k()},5e3);return()=>clearTimeout(e)}},[_,k]);let C=async()=>{try{let{data:{user:e}}=await S.auth.getUser();if(!e)return;let{data:t,error:s}=await S.from("children").select("id, name").order("name");if(s)throw s;y(t||[])}catch(e){console.error("Failed to load children:",e)}finally{v(!1)}},D=async e=>{e.preventDefault(),s&&0!==n.length&&await N({invitee_email:s,child_ids:n,message:d||void 0})&&(r(""),l([]),j(""),null==t||t())},R=e=>{l(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return b?(0,a.jsx)(x.Zp,{className:"w-full max-w-md",children:(0,a.jsx)(x.Wu,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading..."})})}):(0,a.jsxs)(x.Zp,{className:"w-full max-w-md",children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Invite Co-Parent"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(h.J,{htmlFor:"email",children:"Co-Parent Email"}),(0,a.jsx)(o.p,{id:"email",type:"email",value:s,onChange:e=>r(e.target.value),placeholder:"Enter their email address",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(h.J,{htmlFor:"children",children:"Children"}),(0,a.jsx)("div",{className:"mt-2 space-y-2 border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto",children:0===f.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No children found"}):f.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"child-".concat(e.id),checked:n.includes(e.id),onChange:()=>R(e.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"child-".concat(e.id),className:"text-sm font-medium text-gray-700 cursor-pointer",children:e.name})]},e.id))}),n.length>0&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[n.length," child",1!==n.length?"ren":""," selected"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(h.J,{htmlFor:"message",children:"Personal Message (Optional)"}),(0,a.jsx)(m.T,{id:"message",value:d,onChange:e=>j(e.target.value),placeholder:"Add a personal message to your invitation...",rows:3})]}),_&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:_})}),(0,a.jsx)(c.$,{type:"submit",disabled:w||!s||0===n.length,className:"w-full",children:w?"Sending Invitation...":"Send Invitation"})]})})]})}var f=s(6249);function y(){let[e,t]=(0,i.useState)(!1),[s,r]=(0,i.useState)([]),[n,l]=(0,i.useState)([]),[d,o]=(0,i.useState)(!0),[h,m]=(0,i.useState)(null),u=(()=>{try{return(0,g.createClientComponentClient)()}catch(e){return(0,p.k)()}})();(0,i.useEffect)(()=>{y()},[]);let y=async()=>{try{o(!0);let{data:{user:e}}=await u.auth.getUser();if(!e)return;let{data:t}=await u.from("users").select("email").eq("id",e.id).single();if(m(t),null==t?void 0:t.email){let[s,a]=await Promise.all([f.n.getInvitations(e.id),f.n.getReceivedInvitations(t.email)]);r(s),l(a)}}catch(e){console.error("Failed to load invitations:",e)}finally{o(!1)}},b=e=>{switch(e){case"pending":return"text-yellow-600 bg-yellow-50";case"accepted":return"text-green-600 bg-green-50";case"rejected":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}};return d?(0,a.jsx)(x.Zp,{children:(0,a.jsx)(x.Wu,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading invitations..."})})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Co-Parent Connections"}),(0,a.jsx)(c.$,{onClick:()=>t(!0),children:"Invite Co-Parent"})]}),e&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Send Invitation"}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>t(!1),children:"\xd7"})]}),(0,a.jsx)(j,{onSuccess:()=>{t(!1),y()}})]})}),n.length>0&&(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Pending Invitations"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:n.map(e=>{var t,s;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Invitation from ",null==(t=e.users)?void 0:t.full_name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["To co-parent ",null==(s=e.children)?void 0:s.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Expires: ",new Date(e.expires_at).toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)(c.$,{size:"sm",onClick:()=>window.location.href="/invite?code=".concat(e.invitation_code),children:"View"})})]},e.id)})})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Sent Invitations"})}),(0,a.jsx)(x.Wu,{children:0===s.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"No invitations sent yet."}),(0,a.jsx)("p",{className:"text-sm",children:"Invite your co-parent to start sharing schedules and data."})]}):(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Invited ",e.invitee_email]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["For ",null==(t=e.children)?void 0:t.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Sent: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(b(e.status)),children:e.status})})]},e.id)})})})]})]})}class b{async getSharedDataSummary(e){try{let{data:t,error:s}=await this.supabase.from("co_parent_relationships").select("\n          id,\n          child_id,\n          parent_a_id,\n          parent_b_id,\n          time_ratio,\n          created_at,\n          children(id, name, date_of_birth)\n        ").or("parent_a_id.eq.".concat(e,",parent_b_id.eq.").concat(e));if(s)throw s;let a=[],r=[];if(t)for(let s of t){let t=s.parent_a_id===e?s.parent_b_id:s.parent_a_id,{data:i}=await this.supabase.from("users").select("full_name, email").eq("id",t).single();i&&s.children&&(a.push({id:s.id,child_id:s.child_id,partner_id:t,partner_name:i.full_name,partner_email:i.email,child_name:s.children.name,time_ratio:s.time_ratio,created_at:s.created_at}),r.find(e=>e.id===s.children.id)||r.push({id:s.children.id,name:s.children.name,date_of_birth:s.children.date_of_birth}))}let i=[{id:"1",type:"invitation",description:"Co-parent relationships established",created_at:new Date().toISOString(),created_by:e,created_by_name:"You"}];return{relationships:a,sharedChildren:r,recentActivity:i,pendingUpdates:0}}catch(e){return console.error("Failed to get shared data summary:",e),{relationships:[],sharedChildren:[],recentActivity:[],pendingUpdates:0}}}async getRealtimeUpdates(e){return[]}constructor(){this.supabase=(()=>{try{return(0,g.createClientComponentClient)()}catch(e){return(0,p.k)()}})()}}let v=new b;function N(){let[e,t]=(0,i.useState)(null),[s,r]=(0,i.useState)(!0),[n,l]=(0,i.useState)(null),d=(()=>{try{return(0,g.createClientComponentClient)()}catch(e){return(0,p.k)()}})();(0,i.useEffect)(()=>{c()},[]);let c=async()=>{try{let{data:{user:e}}=await d.auth.getUser();if(!e)return;l(e);let s=await v.getSharedDataSummary(e.id);t(s)}catch(e){console.error("Failed to load shared data:",e)}finally{r(!1)}};return s?(0,a.jsx)(x.Zp,{children:(0,a.jsx)(x.Wu,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading shared data..."})})}):e&&0!==e.relationships.length?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Shared Data & Real-time Updates"}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Connected Co-Parents"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:e.relationships.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.partner_name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Co-parenting ",e.child_name]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.partner_email})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-sm font-medium",children:["Time Ratio: ",e.time_ratio,"%"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Connected: ",new Date(e.created_at).toLocaleDateString()]})]})]},e.id))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Shared Children"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:e.sharedChildren.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Born: ",new Date(e.date_of_birth).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Age: ",Math.floor((Date.now()-new Date(e.date_of_birth).getTime())/315576e5)," years"]})]},e.id))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Recent Activity"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-xs text-green-600",children:"Real-time updates enabled"})]})]})})}),(0,a.jsx)(x.Wu,{children:0===e.recentActivity.length?(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500",children:[(0,a.jsx)("p",{children:"No recent activity"}),(0,a.jsx)("p",{className:"text-sm",children:"Updates will appear here when you or your co-parent make changes."})]}):(0,a.jsx)("div",{className:"space-y-3",children:e.recentActivity.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mt-1 ".concat("expense"===e.type?"bg-blue-500":"schedule"===e.type?"bg-green-500":"inventory"===e.type?"bg-purple-500":"bg-gray-500")}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm",children:e.description}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["by ",e.created_by_name," • ",new Date(e.created_at).toLocaleString()]})]})]},e.id))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Data Synchronization"})}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-green-600",children:"✓ All data synchronized"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Your data is automatically shared with connected co-parents"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Last sync: ",new Date().toLocaleTimeString()]})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:"✓"}),(0,a.jsx)("div",{className:"text-sm",children:"Calendar"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:"✓"}),(0,a.jsx)("div",{className:"text-sm",children:"Expenses"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:"✓"}),(0,a.jsx)("div",{className:"text-sm",children:"Inventory"})]})]})]})]})]}):(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Shared Data"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"No co-parent relationships established yet."}),(0,a.jsx)("p",{className:"text-sm",children:"Send an invitation to start sharing data with your co-parent."})]})})]})}function w(){let{user:e,isLoading:t,isAuthenticated:s}=(0,r.As)(),l=(0,n.useRouter)();return((0,i.useEffect)(()=>{t||s||l.push("/login")},[t,s,l]),t)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:["Welcome back, ",e.full_name,"!"]}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Here's your co-parenting dashboard. Manage your preferences, schedule, and more."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Preferences"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Set your scheduling preferences and priorities."}),(0,a.jsx)(d(),{href:"/preferences",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Preferences"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Calendar"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"View and manage your custody schedule."}),(0,a.jsx)(d(),{href:"/calendar",children:(0,a.jsx)(c.$,{className:"w-full",children:"View Calendar"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Adjustments"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Propose and negotiate custody arrangement changes."}),(0,a.jsx)(d(),{href:"/adjustments",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Adjustments"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Inventory"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Track your child's belongings and equipment."}),(0,a.jsx)(d(),{href:"/inventory",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Inventory"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Situations"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Handle special situations and emergencies."}),(0,a.jsx)(d(),{href:"/situations",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Situations"})})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Recent Activity"}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Welcome to CoParent.Online! Start by setting up your preferences."}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Just now"})]})})]}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:(0,a.jsx)(y,{})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,a.jsx)(N,{})})]})}):null}},8539:(e,t,s)=>{"use strict";s.d(t,{T:()=>n});var a=s(5155),r=s(2115),i=s(9434);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","border-gray-300 bg-white placeholder:text-gray-400 focus-visible:ring-blue-500",s),ref:t,...r})});n.displayName="Textarea"},9240:(e,t,s)=>{Promise.resolve().then(s.bind(s,6952))}},e=>{var t=t=>e(e.s=t);e.O(0,[4277,4982,3579,6874,3715,9877,8441,1684,7358],()=>t(9240)),_N_E=e.O()}]);