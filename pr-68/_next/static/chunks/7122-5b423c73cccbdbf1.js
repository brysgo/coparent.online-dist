"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7122],{3382:(e,t,a)=>{a.d(t,{W:()=>i});class i{async createSituation(e){let t=this.generateId(),a=new Date,i=this.getTemplate(e.type),s=this.determineAssignment(e,i),n=this.calculateDeadline(e,i),o={...e,id:t,createdAt:a,assignedTo:s,deadline:n,updates:[],escalations:[],priority:e.priority||(null==i?void 0:i.defaultPriority)||"medium",status:e.status||"created"};return this.situations.set(t,o),await this.addUpdate(t,{userId:o.createdBy,type:"status_change",content:"Situation created: ".concat(o.title),metadata:{status:"created"}}),await this.notifyAssignedParties(o),o}async updateSituation(e,t){let a=this.situations.get(e);if(!a)throw Error("Situation ".concat(e," not found"));let i={...a,...t};return this.situations.set(e,i),t.status&&t.status!==a.status&&await this.addUpdate(e,{userId:"system",type:"status_change",content:"Status changed from ".concat(a.status," to ").concat(t.status),metadata:{oldStatus:a.status,newStatus:t.status}}),i}async addUpdate(e,t){let a=this.situations.get(e);if(!a)throw Error("Situation ".concat(e," not found"));let i={id:this.generateId(),situationId:e,timestamp:new Date,...t};a.updates.push(i),this.situations.set(e,a)}async resolveSituation(e,t,a){let i=this.situations.get(e);if(!i)throw Error("Situation ".concat(e," not found"));await this.updateSituation(e,{status:"resolved",resolvedAt:new Date}),await this.addUpdate(e,{userId:"system",type:"status_change",content:"Situation resolved: ".concat(t),metadata:{resolution:t,...a}}),i.gamificationImpact&&await this.applyGamificationImpact(i)}async escalateSituation(e,t){let a=this.situations.get(e);if(!a)throw Error("Situation ".concat(e," not found"));let i=a.escalations.length+1,s={id:this.generateId(),situationId:e,level:i,reason:t,triggeredAt:new Date,triggeredBy:"user",actions:this.getEscalationActions(a,i),resolved:!1};a.escalations.push(s),await this.updateSituation(e,{status:"escalated",priority:this.increasePriority(a.priority)}),await this.addUpdate(e,{userId:"system",type:"escalation",content:"Situation escalated (Level ".concat(i,"): ").concat(t),metadata:{escalationLevel:i,reason:t}}),await this.executeEscalationActions(s)}async getSituations(e){let t=Array.from(this.situations.values());return e.relationshipId&&(t=t.filter(t=>t.relationshipId===e.relationshipId)),e.status&&(t=t.filter(t=>e.status.includes(t.status))),e.type&&(t=t.filter(t=>e.type.includes(t.type))),e.assignedTo&&(t=t.filter(t=>t.assignedTo.includes(e.assignedTo))),e.priority&&(t=t.filter(t=>e.priority.includes(t.priority))),t.sort((e,t)=>{let a={urgent:4,high:3,medium:2,low:1},i=a[e.priority],s=a[t.priority];return i!==s?s-i:t.createdAt.getTime()-e.createdAt.getTime()})}getSituation(e){return this.situations.get(e)}getOverdueSituations(){let e=new Date;return Array.from(this.situations.values()).filter(t=>t.deadline&&t.deadline<e&&!["resolved","cancelled"].includes(t.status))}getSituationsRequiringEscalation(){let e=Date.now();return Array.from(this.situations.values()).filter(t=>!["resolved","cancelled"].includes(t.status)&&!t.updates.some(e=>"status_change"===e.type&&e.content.includes("acknowledged"))&&e-t.createdAt.getTime()>("urgent"===t.priority?9e5:72e5))}initializeTemplates(){this.templates.set("emergency-pickup",{id:"emergency-pickup",type:"emergency",name:"Emergency School Pickup",description:"Child needs immediate pickup from school",defaultPriority:"urgent",defaultDeadlineHours:1,requiredFields:["location","emergencyType"],metadataSchema:{emergencyType:"pickup",requiresPickup:!0},autoAssignmentRules:[{condition:"emergency",assignTo:"both"}]}),this.templates.set("forgotten-item",{id:"forgotten-item",type:"logistics",name:"Forgotten Item",description:"Child forgot important item at other parent's house",defaultPriority:"medium",defaultDeadlineHours:24,requiredFields:["items"],metadataSchema:{logisticsType:"forgotten_item"},autoAssignmentRules:[{condition:"logistics",assignTo:"other_parent"}]}),this.templates.set("behavioral-incident",{id:"behavioral-incident",type:"behavioral",name:"Behavioral Incident",description:"Child behavioral issue requiring coordination",defaultPriority:"high",defaultDeadlineHours:48,requiredFields:["incident","childId"],metadataSchema:{behaviorType:"disciplinary",privacyLevel:"both_parents"},autoAssignmentRules:[{condition:"behavioral",assignTo:"both"}]})}getTemplate(e){return Array.from(this.templates.values()).find(t=>t.type===e)}determineAssignment(e,t){if(e.assignedTo&&e.assignedTo.length>0)return e.assignedTo;if(null==t?void 0:t.autoAssignmentRules)switch(t.autoAssignmentRules[0].assignTo){case"both":return e.involvedParties;case"other_parent":return e.involvedParties.filter(t=>t!==e.createdBy)}return[e.createdBy]}calculateDeadline(e,t){if(e.deadline)return e.deadline;if(null==t?void 0:t.defaultDeadlineHours){let e=new Date;return e.setHours(e.getHours()+t.defaultDeadlineHours),e}let a={urgent:2,high:24,medium:72,low:168}[e.priority||"medium"],i=new Date;return i.setHours(i.getHours()+a),i}increasePriority(e){let t=["low","medium","high","urgent"],a=Math.min(t.indexOf(e)+1,t.length-1);return t[a]}getEscalationActions(e,t){let a=[];switch(t){case 1:a.push("send_reminder","notify_assigned_parties");break;case 2:a.push("increase_priority","notify_emergency_contacts");break;case 3:a.push("create_follow_up_situation","notify_external_parties");break;default:a.push("manual_intervention_required")}return a}async executeEscalationActions(e){console.log("Executing escalation actions for situation ".concat(e.situationId,":"),e.actions)}async notifyAssignedParties(e){console.log("Notifying assigned parties for situation ".concat(e.id,":"),e.assignedTo)}async applyGamificationImpact(e){e.gamificationImpact&&console.log("Applying gamification impact for situation ".concat(e.id,":"),e.gamificationImpact)}generateId(){return"sit_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}constructor(){this.situations=new Map,this.templates=new Map,this.initializeTemplates()}}new i},7122:(e,t,a)=>{a.d(t,{b:()=>l});var i=a(5155),s=a(2115),n=a(8417),o=a(285),r=a(6695),c=a(4899);function l(e){var t;let{situation:a,currentUserId:l,onResponseSent:d,isGuestMode:u=!1}=e,[g,m]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),[y,f]=(0,s.useState)(""),[v,w]=(0,s.useState)(""),x=async e=>{if(!g){m(!0),p(e);try{let t={situationId:a.id,userId:l,responseType:e,message:y||void 0,estimatedArrival:v?new Date(v):void 0};if(u){c.B.saveGuestInteraction("demo_action",{type:"emergency_quick_response",situationId:a.id,responseType:e,message:y,source:"quick_response"});let i={id:"qr_".concat(Date.now()),timestamp:new Date,...t};d&&d(i)}else await n.N.sendQuickResponse(a.id,t);f(""),w(""),p(null)}catch(e){console.error("Error sending quick response:",e)}finally{m(!1)}}};return(0,i.jsx)(r.Zp,{className:"border-l-4 border-l-red-500",children:(0,i.jsxs)(r.Wu,{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,i.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["\uD83D\uDEA8 ",a.title]}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:[(e=>{let t=Math.floor((new Date().getTime()-e.getTime())/6e4);if(t<1)return"Just now";if(t<60)return"".concat(t,"m ago");let a=Math.floor(t/60);if(a<24)return"".concat(a,"h ago");let i=Math.floor(a/24);return"".concat(i,"d ago")})(a.createdAt)," • ",(null==(t=a.metadata.location)?void 0:t.name)||"Location not specified"]})]})]}),(0,i.jsxs)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat((e=>{switch(e){case 5:return"bg-red-600 text-white";case 4:return"bg-red-500 text-white";case 3:return"bg-orange-500 text-white";case 2:return"bg-yellow-500 text-white";case 1:return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}})(a.metadata.urgencyLevel)),children:["Level ",a.metadata.urgencyLevel]})]}),(0,i.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,i.jsx)("p",{className:"text-gray-800 mb-2",children:a.description}),a.metadata.location&&(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,i.jsx)("span",{className:"font-medium",children:"Location:"})," ",a.metadata.location.address]}),a.metadata.requiresPickup&&(0,i.jsx)("div",{className:"text-sm text-orange-600 font-medium mt-1",children:"⚠️ Pickup required"}),a.metadata.requiresMedicalAttention&&(0,i.jsx)("div",{className:"text-sm text-red-600 font-medium mt-1",children:"\uD83C\uDFE5 Medical attention needed"})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900",children:"Quick Response:"}),(0,i.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{type:"acknowledged",label:"Acknowledged",icon:"✓",description:"I see this emergency",color:"bg-blue-100 text-blue-800 hover:bg-blue-200"},{type:"on_way",label:"On My Way",icon:"\uD83D\uDE97",description:"I'm heading there now",color:"bg-green-100 text-green-800 hover:bg-green-200"},{type:"handled",label:"Handled",icon:"✅",description:"Situation is resolved",color:"bg-green-100 text-green-800 hover:bg-green-200"},{type:"need_help",label:"Need Help",icon:"\uD83C\uDD98",description:"I need additional assistance",color:"bg-orange-100 text-orange-800 hover:bg-orange-200"},{type:"cant_help",label:"Can't Help",icon:"❌",description:"I'm unable to assist",color:"bg-red-100 text-red-800 hover:bg-red-200"}].map(e=>(0,i.jsxs)(o.$,{variant:"outline",className:"h-auto p-4 flex flex-col items-center space-y-2 ".concat(e.color," ").concat(h===e.type?"ring-2 ring-blue-500":""),onClick:()=>x(e.type),disabled:g,children:[(0,i.jsx)("span",{className:"text-2xl",children:e.icon}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"font-medium",children:e.label}),(0,i.jsx)("div",{className:"text-xs opacity-75",children:e.description})]})]},e.type))}),("on_way"===h||"need_help"===h||"cant_help"===h)&&(0,i.jsxs)("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg",children:["on_way"===h&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estimated Arrival Time"}),(0,i.jsx)("input",{type:"datetime-local",value:v,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:new Date().toISOString().slice(0,16)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Message (Optional)"}),(0,i.jsx)("textarea",{value:y,onChange:e=>f(e.target.value),placeholder:"Add any additional details...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:2})]})]}),g&&(0,i.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),(0,i.jsx)("span",{className:"ml-2 text-gray-600",children:"Sending response..."})]})]}),(0,i.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,i.jsxs)(o.$,{variant:"outline",size:"sm",children:["\uD83D\uDCDE Call ",a.assignedTo[0]||"Parent"]}),(0,i.jsx)(o.$,{variant:"outline",size:"sm",children:"\uD83D\uDCCD Get Directions"}),a.metadata.urgencyLevel>=4&&(0,i.jsx)(o.$,{variant:"outline",size:"sm",className:"text-red-600 border-red-300 hover:bg-red-50",children:"\uD83D\uDEA8 Call 911"})]})}),u&&(0,i.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,i.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,i.jsx)("span",{className:"font-medium",children:"Demo Mode:"})," In a real emergency, your response would immediately notify all involved parties and update the situation status."]})})]})})}},8417:(e,t,a)=>{a.d(t,{N:()=>n,h:()=>s});var i=a(3382);class s extends i.W{async createEmergency(e){let t={...e,priority:"urgent",status:"created"},a=await this.createSituation(t),i=this.calculateEstimatedResolutionTime(a.metadata.urgencyLevel);return a.metadata={...a.metadata,estimatedResolutionTime:i},await this.sendImmediateNotifications(a),await this.scheduleEmergencyEscalation(a),a}async sendQuickResponse(e,t){let a=this.getSituation(e);if(!a)throw Error("Situation ".concat(e," not found"));let i={id:this.generateId(),timestamp:new Date,...t};this.quickResponses.has(e)||this.quickResponses.set(e,[]),this.quickResponses.get(e).push(i),await this.handleQuickResponseUpdate(a,i),await this.addUpdate(e,{userId:i.userId,type:"comment",content:this.formatQuickResponseMessage(i),metadata:{responseType:i.responseType,estimatedArrival:i.estimatedArrival,location:i.location}}),await this.notifyQuickResponse(a,i)}async trackLocation(e,t,a){this.locationTracking.has(e)||this.locationTracking.set(e,new Map),this.locationTracking.get(e).set(t,a),await this.addUpdate(e,{userId:t,type:"comment",content:"Location updated: ".concat(a[0].toFixed(6),", ").concat(a[1].toFixed(6)),metadata:{location:a,locationType:"gps_update"}})}async escalateToEmergencyContacts(e){let t=this.getSituation(e);if(!t)throw Error("Emergency situation ".concat(e," not found"));let a=t.metadata.emergencyContacts||[];if(0===a.length)return void console.warn("No emergency contacts configured for situation ".concat(e));await this.escalateSituation(e,"No response from assigned parties - escalating to emergency contacts"),await this.notifyEmergencyContacts(t,a),t.metadata.urgencyLevel>=4&&await this.handleHighUrgencyEscalation(t)}async getActiveEmergencies(e){return(await this.getSituations({type:["emergency"],status:["created","acknowledged","in-progress","escalated"]})).filter(t=>t.involvedParties.includes(e)||t.assignedTo.includes(e))}getQuickResponses(e){return this.quickResponses.get(e)||[]}getLocationTracking(e){return this.locationTracking.get(e)||new Map}requiresImmediateEscalation(e){let{urgencyLevel:t,requiresMedicalAttention:a}=e.metadata;return!!(5===t||a&&t>=3||e.deadline&&e.deadline.getTime()-Date.now()<9e5)||!1}calculateEstimatedResolutionTime(e){switch(e){case 5:return 15;case 4:return 30;case 3:default:return 60;case 2:return 120;case 1:return 240}}async sendImmediateNotifications(e){var t;console.log("\uD83D\uDEA8 EMERGENCY NOTIFICATION: ".concat(e.title)),console.log("Assigned to: ".concat(e.assignedTo.join(", "))),console.log("Urgency Level: ".concat(e.metadata.urgencyLevel,"/5")),console.log("Location: ".concat((null==(t=e.metadata.location)?void 0:t.name)||"Not specified"))}async scheduleEmergencyEscalation(e){let t=this.getEscalationDelay(e);console.log("Scheduling emergency escalation for situation ".concat(e.id," in ").concat(t," minutes"))}getEscalationDelay(e){let{urgencyLevel:t}=e.metadata;switch(t){case 5:return 5;case 4:return 10;case 3:default:return 15;case 2:return 30;case 1:return 60}}async handleQuickResponseUpdate(e,t){let a=e.status;switch(t.responseType){case"acknowledged":"created"===e.status&&(a="acknowledged");break;case"on_way":a="in-progress";break;case"handled":a="resolved";break;case"need_help":await this.escalateToEmergencyContacts(e.id);break;case"cant_help":await this.handleCannotHelp(e,t)}a!==e.status&&await this.updateSituation(e.id,{status:a})}formatQuickResponseMessage(e){let t={acknowledged:"Acknowledged the emergency",on_way:"On my way",handled:"Situation handled",need_help:"Need additional help",cant_help:"Cannot help with this emergency"}[e.responseType];return e.estimatedArrival&&(t+=" - ETA: ".concat(e.estimatedArrival.toLocaleTimeString())),e.message&&(t+=" - ".concat(e.message)),t}async notifyQuickResponse(e,t){let a=e.involvedParties.filter(e=>e!==t.userId);console.log("Notifying parties about quick response: ".concat(a.join(", "))),console.log("Response: ".concat(this.formatQuickResponseMessage(t)))}async notifyEmergencyContacts(e,t){console.log("\uD83D\uDEA8 ESCALATING TO EMERGENCY CONTACTS: ".concat(t.join(", "))),console.log("Emergency: ".concat(e.title)),console.log("Urgency: ".concat(e.metadata.urgencyLevel,"/5"))}async handleHighUrgencyEscalation(e){if(5===e.metadata.urgencyLevel){var t;console.log("⚠️  LEVEL 5 EMERGENCY - Consider calling 911"),console.log("Emergency: ".concat(e.title)),console.log("Location: ".concat((null==(t=e.metadata.location)?void 0:t.address)||"Unknown"))}await this.addUpdate(e.id,{userId:"system",type:"escalation",content:"High urgency emergency (Level ".concat(e.metadata.urgencyLevel,") - Additional safety protocols activated"),metadata:{urgencyLevel:e.metadata.urgencyLevel,autoEscalation:!0}})}async handleCannotHelp(e,t){let a=e.involvedParties.filter(a=>a!==t.userId&&!e.assignedTo.includes(a));a.length>0?(await this.updateSituation(e.id,{assignedTo:[...e.assignedTo,...a]}),await this.addUpdate(e.id,{userId:"system",type:"status_change",content:"Reassigned to additional parties: ".concat(a.join(", ")),metadata:{reassignment:!0,originalResponder:t.userId}})):await this.escalateToEmergencyContacts(e.id)}constructor(...e){super(...e),this.quickResponses=new Map,this.locationTracking=new Map}}let n=new s}}]);