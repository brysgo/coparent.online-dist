(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{560:(e,a,t)=>{Promise.resolve().then(t.bind(t,3445))},3445:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>m});var r=t(5155),i=t(2115),n=t(5695),s=t(6874),o=t.n(s),l=t(2099),d=t(3715),c=t(9454);function u(){let e=(0,n.useRouter)(),a=(0,n.useSearchParams)(),{convertGuestToUser:t,isGuest:s}=(0,d.As)(),[u,m]=(0,i.useState)(""),[h,g]=(0,i.useState)(""),[p,v]=(0,i.useState)(""),[x,f]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[_,w]=(0,i.useState)(null),j="true"===a.get("convert"),N=a.get("invitation_code"),k=async a=>{a.preventDefault(),f(!0),y(null),w(null);try{if(j&&s)await t(u,h,p),e.push("/dashboard");else{let a=(0,l.k)(),{data:t,error:r}=await a.auth.signUp({email:u,password:h,options:{data:{full_name:p}}});if(r)throw r;if(t.user){let{error:r}=await a.from("users").insert({id:t.user.id,email:u,full_name:p,credit_score:100});if(r)throw r;if(N)try{await c.n.acceptInvitation(N),e.push("/dashboard?invitation_accepted=true")}catch(a){console.error("Failed to accept invitation:",a),e.push("/dashboard")}else e.push("/dashboard")}}}catch(a){console.error("Error during sign up:",a);let e=a instanceof Error?a.message:"An error occurred during sign up";j?w(e):y(e)}finally{f(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white",children:j?"Save Your Demo Progress":"Create your account"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:j?"Convert your demo experience to a permanent account and keep all your preferences":(0,r.jsxs)(r.Fragment,{children:["Or"," ",(0,r.jsx)(o(),{href:"/login",className:"font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300",children:"sign in to your existing account"})]})}),j&&(0,r.jsx)("div",{className:"mt-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200 text-center",children:[(0,r.jsx)("strong",{children:"\uD83C\uDF89 Great news!"})," All your demo preferences and progress will be preserved when you create your account."]})})]}),(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:k,children:[(0,r.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"full-name",className:"sr-only",children:"Full Name"}),(0,r.jsx)("input",{id:"full-name",name:"fullName",type:"text",required:!0,"data-testid":"signup-full-name",className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Full Name",value:p,onChange:e=>v(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),(0,r.jsx)("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,"data-testid":"signup-email",className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Email address",value:u,onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,r.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,"data-testid":"signup-password",className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Password",value:h,onChange:e=>g(e.target.value)})]})]}),(b||_)&&(0,r.jsx)("div",{className:"rounded-md bg-red-50 dark:bg-red-900/30 p-4","data-testid":"conversion-error",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:b||_})})]})}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:x,"data-testid":j?"convert-account":"signup-submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:x?j?"Converting Demo to Real Account...":"Creating account...":j?"\uD83D\uDCBE Convert Demo to Real Account":"Sign up"})})]}),j&&(0,r.jsxs)("div",{className:"mt-6 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-green-900 dark:text-green-100 mb-3",children:"\uD83D\uDE80 What you'll get with a real account:"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-green-800 dark:text-green-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"✓"}),(0,r.jsx)("span",{children:"All demo preferences saved"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"✓"}),(0,r.jsx)("span",{children:"Invite co-parent to collaborate"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"✓"}),(0,r.jsx)("span",{children:"Real calendar synchronization"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"✓"}),(0,r.jsx)("span",{children:"24/7 secure data access"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"✓"}),(0,r.jsx)("span",{children:"Advanced AI conflict resolution"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"✓"}),(0,r.jsx)("span",{children:"Priority customer support"})]})]})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-700"})}),(0,r.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,r.jsx)("span",{className:"px-2 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:"Or continue with"})})]}),(0,r.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("a",{href:"#",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700",children:[(0,r.jsx)("span",{className:"sr-only",children:"Sign in with Google"}),(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("a",{href:"#",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700",children:[(0,r.jsx)("span",{className:"sr-only",children:"Sign in with Facebook"}),(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z",clipRule:"evenodd"})})]})})]})]})]})})}function m(){return(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,r.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})}),children:(0,r.jsx)(u,{})})}},4383:(e,a,t)=>{"use strict";t.d(a,{Y:()=>n});var r=t(9509);class i{async sendInvitationEmail(e){let a="Co-parenting invitation from ".concat(e.inviter_name),t=this.generateInvitationEmailContent(e);console.log("--- EMAIL WOULD BE SENT ---"),console.log("To: ".concat(e.invitee_email)),console.log("From: ".concat(e.inviter_email)),console.log("Subject: ".concat(a)),console.log("Content:\n".concat(t)),console.log("--- END EMAIL ---")}async sendEmail(e,a,t){console.log("--- EMAIL WOULD BE SENT ---"),console.log("To: ".concat(e)),console.log("Subject: ".concat(a)),console.log("Content:\n".concat(t)),console.log("--- END EMAIL ---")}generateInvitationEmailContent(e){let a="".concat(r.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000","/invite?code=").concat(e.invitation_code);return"\nHi there!\n\n".concat(e.inviter_name," (").concat(e.inviter_email,") has invited you to join CoParent.Online to co-parent ").concat(e.child_name,".\n\nBenefits of joining CoParent.Online:\n• Share schedules and coordinate custody seamlessly\n• Track shared expenses and manage finances together  \n• Manage your child's inventory and belongings\n• Communicate effectively through our platform\n• Access mediation tools for resolving conflicts\n\n").concat(e.message?"Personal message from ".concat(e.inviter_name,':\n"').concat(e.message,'"\n\n'):"","\n\nTo accept this invitation, click the link below:\n").concat(a,"\n\nThis invitation will expire on ").concat(new Date(e.expires_at).toLocaleDateString(),".\n\nIf you already have an account, simply log in and the invitation will be processed automatically.\n\nIf you don't have an account yet, you'll be guided through a quick signup process.\n\nBest regards,\nThe CoParent.Online Team\n\n---\nIf you did not expect this invitation or believe this was sent in error, you can safely ignore this email.\n    ").trim()}}function n(){return new i}},5695:(e,a,t)=>{"use strict";var r=t(8999);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},9454:(e,a,t)=>{"use strict";t.d(a,{n:()=>o});var r=t(3579),i=t(2099),n=t(4383);class s{async sendInvitation(e){let{data:{user:a},error:t}=await this.supabase.auth.getUser();if(t||!a)throw Error("User not authenticated");let{data:r,error:i}=await this.supabase.from("users").select("full_name, email").eq("id",a.id).single();if(i||!r)throw Error("Failed to get user information");let{data:n,error:s}=await this.supabase.from("children").select("name").eq("id",e.child_id).single();if(s||!n)throw Error("Failed to get child information");let{data:o}=await this.supabase.from("co_parent_invitations").select("id, status").eq("inviter_id",a.id).eq("invitee_email",e.invitee_email).eq("child_id",e.child_id).eq("status","pending").single();if(o)throw Error("An invitation is already pending for this email and child");let{data:l,error:d}=await this.supabase.from("co_parent_invitations").insert({inviter_id:a.id,invitee_email:e.invitee_email,child_id:e.child_id}).select().single();if(d||!l)throw Error("Failed to create invitation");let c={inviter_name:r.full_name,inviter_email:r.email,invitee_email:e.invitee_email,child_name:n.name,invitation_code:l.invitation_code,expires_at:l.expires_at,message:e.message};try{await this.sendInvitationEmail(c)}catch(e){console.error("Failed to send invitation email:",e)}return l}async sendBulkInvitation(e){let{data:{user:a},error:t}=await this.supabase.auth.getUser();if(t||!a)throw Error("User not authenticated");let{data:r,error:i}=await this.supabase.from("users").select("full_name, email").eq("id",a.id).single();if(i||!r)throw Error("Failed to get user information");let{data:n,error:s}=await this.supabase.from("children").select("id, name").in("id",e.child_ids);if(s||!n)throw Error("Failed to get children information");let{data:o}=await this.supabase.from("co_parent_invitations").select("child_id").eq("inviter_id",a.id).eq("invitee_email",e.invitee_email).in("child_id",e.child_ids).eq("status","pending");if(o&&o.length>0){let e=o.map(e=>e.child_id),a=n.filter(a=>e.includes(a.id)).map(e=>e.name);throw Error("Invitations are already pending for: ".concat(a.join(", ")))}let l=e.child_ids.map(t=>({inviter_id:a.id,invitee_email:e.invitee_email,child_id:t})),{data:d,error:c}=await this.supabase.from("co_parent_invitations").insert(l).select();if(c||!d)throw Error("Failed to create invitations");let u=n.map(e=>e.name),m={inviter_name:r.full_name,inviter_email:r.email,invitee_email:e.invitee_email,child_name:1===u.length?u[0]:u.join(", "),invitation_code:d[0].invitation_code,expires_at:d[0].expires_at,message:e.message};try{await this.sendInvitationEmail(m)}catch(e){console.error("Failed to send invitation email:",e)}return d}async getInvitations(e){let{data:a,error:t}=await this.supabase.from("co_parent_invitations").select("\n        *,\n        children(name),\n        users!inviter_id(full_name, email)\n      ").eq("inviter_id",e).order("created_at",{ascending:!1});if(t)throw Error("Failed to fetch invitations");return a||[]}async getReceivedInvitations(e){let{data:a,error:t}=await this.supabase.from("co_parent_invitations").select("\n        *,\n        children(name),\n        users!inviter_id(full_name, email)\n      ").eq("invitee_email",e).eq("status","pending").order("created_at",{ascending:!1});if(t)throw Error("Failed to fetch received invitations");return a||[]}async acceptInvitation(e){let{data:{user:a},error:t}=await this.supabase.auth.getUser();if(t||!a)throw Error("User not authenticated");let{data:r,error:i}=await this.supabase.from("users").select("email").eq("id",a.id).single();if(i||!r)throw Error("Failed to get user information");let{data:n,error:s}=await this.supabase.from("co_parent_invitations").select("*").eq("invitation_code",e).eq("invitee_email",r.email).eq("status","pending").single();if(s||!n)throw Error("Invitation not found or already processed");if(new Date(n.expires_at)<new Date)throw await this.supabase.from("co_parent_invitations").update({status:"expired"}).eq("id",n.id),Error("Invitation has expired");let{error:o}=await this.supabase.from("co_parent_relationships").insert({child_id:n.child_id,parent_a_id:n.inviter_id,parent_b_id:a.id});if(o)throw Error("Failed to create co-parent relationship");let{error:l}=await this.supabase.from("co_parent_invitations").update({status:"accepted",accepted_at:new Date().toISOString()}).eq("id",n.id);if(l)throw Error("Failed to update invitation status")}async rejectInvitation(e){let{data:{user:a},error:t}=await this.supabase.auth.getUser();if(t||!a)throw Error("User not authenticated");let{data:r,error:i}=await this.supabase.from("users").select("email").eq("id",a.id).single();if(i||!r)throw Error("Failed to get user information");let{error:n}=await this.supabase.from("co_parent_invitations").update({status:"rejected"}).eq("invitation_code",e).eq("invitee_email",r.email).eq("status","pending");if(n)throw Error("Failed to reject invitation")}async sendInvitationEmail(e){let a=(0,n.Y)();await a.sendInvitationEmail(e)}constructor(){this.supabase=(()=>{try{return(0,r.createClientComponentClient)()}catch(e){return(0,i.k)()}})()}}let o=new s}},e=>{var a=a=>e(e.s=a);e.O(0,[982,579,874,715,441,684,358],()=>a(560)),_N_E=e.O()}]);