(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[896],{6661:(e,t,s)=>{"use strict";s.d(t,{NotificationPreferences:()=>a});var i=s(5155),n=s(2115);class r{async initialize(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("Push notifications are not supported in this browser"),!1;try{return this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service worker registered successfully"),!0}catch(e){return console.error("Service worker registration failed:",e),!1}}async requestPermission(){return"Notification"in window?"default"===Notification.permission?await Notification.requestPermission():Notification.permission:(console.warn("This browser does not support notifications"),"denied")}async subscribeToPush(){if(!this.registration)return console.error("Service worker not registered"),null;try{let e=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array("BEl62iUYgUivxIkv69yViEuiBIa40HI80NM7f20RIlX1SfgTR-_T6QGz1L2Tl-B6TlYKCnfG6KHs0v3aH-LQVB4")});return console.log("Push subscription successful:",e),e}catch(e){return console.error("Failed to subscribe to push notifications:",e),null}}async unsubscribeFromPush(){if(!this.registration)return!1;try{let e=await this.registration.pushManager.getSubscription();if(e)return await e.unsubscribe(),console.log("Successfully unsubscribed from push notifications"),!0}catch(e){console.error("Failed to unsubscribe from push notifications:",e)}return!1}async isSubscribed(){if(!this.registration)return!1;try{let e=await this.registration.pushManager.getSubscription();return null!==e}catch(e){return console.error("Failed to check subscription status:",e),!1}}async showLocalNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"granted"===await this.requestPermission()&&new Notification(e,{icon:"/favicon.ico",badge:"/favicon.ico",...t})}async testNotification(){await this.showLocalNotification("CoParent.Online Test",{body:"This is a test notification from CoParent.Online",tag:"test-notification",requireInteraction:!1,actions:[{action:"view",title:"View Dashboard"},{action:"dismiss",title:"Dismiss"}]})}urlBase64ToUint8Array(e){let t="=".repeat((4-e.length%4)%4),s=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(s),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}constructor(){this.registration=null}}function a(e){var t,s,a;let{userId:o,initialPreferences:c=[]}=e,[l,d]=(0,n.useState)(c),[u,h]=(0,n.useState)(!1),[m,g]=(0,n.useState)(!1),[b,p]=(0,n.useState)(!1),[f,x]=(0,n.useState)("default"),[y,v]=(0,n.useState)(!1),N=new r;(0,n.useEffect)(()=>{0===c.length&&j(),w()},[]);let w=async()=>{let e=await N.initialize();p(e),e&&(x(Notification.permission),v(await N.isSubscribed()))},j=async()=>{h(!0);try{let e=_(o);d(e)}catch(e){console.error("Error loading preferences:",e)}finally{h(!1)}},_=e=>{let t=["email","push","sms"],s=[],i=1;return["schedule_change","expense_added","emergency","invitation","reminder","situation_created","situation_updated","situation_escalated"].forEach(n=>{t.forEach(t=>{s.push({id:"pref-".concat(i++),user_id:e,event_type:n,channel:t,enabled:"email"===t||"push"===t&&["emergency","situation_escalated"].includes(n),quiet_hours_start:"22:00",quiet_hours_end:"08:00",emergency_override:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})})}),s},S=async(e,t)=>{var s;if(t.enabled&&(null==(s=l.find(t=>t.id===e))?void 0:s.channel)==="push"){let e=await N.requestPermission();if(x(e),"granted"!==e||y){if("denied"===e)return}else await N.subscribeToPush()&&v(!0)}d(s=>s.map(s=>s.id===e?{...s,...t}:s))},P=async()=>{g(!0);try{console.log("Saving preferences:",l),await new Promise(e=>setTimeout(e,1e3))}catch(e){console.error("Error saving preferences:",e)}finally{g(!1)}};if(u)return(0,i.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,i.jsx)("div",{className:"text-gray-600",children:"Loading notification preferences..."})});let k=l.reduce((e,t)=>(e[t.event_type]||(e[t.event_type]={}),e[t.event_type][t.channel]=t,e),{});return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,i.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"Quick Settings"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("label",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"time",value:(null==(t=l[0])?void 0:t.quiet_hours_start)||"22:00",onChange:e=>{let t=e.target.value;d(e=>e.map(e=>({...e,quiet_hours_start:t})))},className:"border rounded px-2 py-1"}),(0,i.jsx)("span",{className:"text-sm",children:"Quiet hours start"})]}),(0,i.jsxs)("label",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"time",value:(null==(s=l[0])?void 0:s.quiet_hours_end)||"08:00",onChange:e=>{let t=e.target.value;d(e=>e.map(e=>({...e,quiet_hours_end:t})))},className:"border rounded px-2 py-1"}),(0,i.jsx)("span",{className:"text-sm",children:"Quiet hours end"})]})]}),(0,i.jsxs)("label",{className:"flex items-center gap-2",children:[(0,i.jsx)("input",{type:"checkbox",checked:(null==(a=l[0])?void 0:a.emergency_override)||!0,onChange:e=>{d(t=>t.map(t=>({...t,emergency_override:e.target.checked})))},className:"rounded"}),(0,i.jsx)("span",{className:"text-sm",children:"Allow emergency notifications during quiet hours"})]})]})]}),b&&(0,i.jsxs)("div",{className:"p-4 rounded-lg ".concat("granted"===f?"bg-green-50":"denied"===f?"bg-red-50":"bg-yellow-50"),children:[(0,i.jsx)("h4",{className:"font-semibold mb-2 ".concat("granted"===f?"text-green-900":"denied"===f?"text-red-900":"text-yellow-900"),children:"Push Notification Status"}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("p",{className:"text-sm ".concat("granted"===f?"text-green-800":"denied"===f?"text-red-800":"text-yellow-800"),children:["granted"===f&&y&&"Push notifications are enabled and active","granted"===f&&!y&&"Push notifications are allowed but not subscribed","denied"===f&&"Push notifications are blocked by your browser","default"===f&&"Push notifications permission not yet granted"]})}),(0,i.jsxs)("div",{className:"flex gap-2",children:["granted"===f&&(0,i.jsx)("button",{onClick:()=>N.testNotification(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Test Notification"}),"default"===f&&(0,i.jsx)("button",{onClick:async()=>{let e=await N.requestPermission();x(e),"granted"===e&&v(!!await N.subscribeToPush())},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Enable Push Notifications"})]})]})]}),(0,i.jsxs)("div",{className:"bg-white border rounded-lg overflow-hidden",children:[(0,i.jsx)("div",{className:"bg-gray-50 px-4 py-2 border-b",children:(0,i.jsx)("h3",{className:"font-semibold",children:"Notification Preferences"})}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b bg-gray-50",children:[(0,i.jsx)("th",{className:"text-left p-4 font-medium",children:"Event Type"}),(0,i.jsx)("th",{className:"text-center p-4 font-medium",children:"Email"}),(0,i.jsx)("th",{className:"text-center p-4 font-medium",children:"Push"}),(0,i.jsx)("th",{className:"text-center p-4 font-medium",children:"SMS (Coming Soon)"})]})}),(0,i.jsx)("tbody",{children:Object.entries({schedule_change:"Schedule Changes",expense_added:"New Expenses",emergency:"Emergency Situations",invitation:"Co-parent Invitations",reminder:"Reminders",situation_created:"New Situations",situation_updated:"Situation Updates",situation_escalated:"Escalated Situations"}).map(e=>{let[t,s]=e,n=k[t]||{};return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-4",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:s}),"emergency"===t&&(0,i.jsx)("div",{className:"text-sm text-orange-600",children:"High Priority"})]})}),["email","push","sms"].map(e=>{let t=n[e],s="sms"===e||"push"===e&&(!b||"denied"===f);return(0,i.jsx)("td",{className:"p-4 text-center",children:(0,i.jsx)("input",{type:"checkbox",checked:(null==t?void 0:t.enabled)||!1,disabled:s,onChange:e=>{t&&S(t.id,{enabled:e.target.checked})},className:"rounded ".concat(s?"opacity-50":"")})},e)})]},t)})})]})})]}),(0,i.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg",children:[(0,i.jsx)("h4",{className:"font-semibold text-orange-900 mb-2",children:"Emergency Notifications"}),(0,i.jsx)("p",{className:"text-sm text-orange-800",children:"Emergency situations and escalated notifications will always be sent regardless of quiet hours when emergency override is enabled. This ensures you never miss critical information about your child."})]}),(0,i.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,i.jsx)("button",{onClick:()=>j(),disabled:u||m,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"Reset"}),(0,i.jsx)("button",{onClick:P,disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:m?"Saving...":"Save Preferences"})]})]})}},8768:(e,t,s)=>{Promise.resolve().then(s.bind(s,6661))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(8768)),_N_E=e.O()}]);