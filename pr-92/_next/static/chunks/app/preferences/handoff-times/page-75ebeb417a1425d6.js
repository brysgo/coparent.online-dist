(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[581],{844:(e,r,t)=>{"use strict";t.d(r,{GY:()=>c,h9:()=>l,hV:()=>i});var s=t(9509);function n(){let e=a();return"main"===e||"master"===e||"production"===e?"production":"development"}function a(){return"copilot/fix-81"}function l(){if("production"===n())return{url:"https://placeholder.supabase.co",anonKey:"placeholder-anon-key",serviceRoleKey:s.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};{let e=s.env.SUPABASE_DEV_URL||"https://bqiapoplmkkrtnsmmxhs.supabase.co";return{url:e,anonKey:s.env.SUPABASE_DEV_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDA3OTMsImV4cCI6MjA2ODAxNjc5M30.bZGNGvb8XYZSWkbfMYMNBAzoedp4SGOIerHmNcRqUsk",serviceRoleKey:s.env.SUPABASE_DEV_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjQ0MDc5MywiZXhwIjoyMDY4MDE2NzkzfQ.7m9y2vqrq1Sd8bX6dl6A47WQbZoQHGKc7o2rzrcTjKI"}}}function i(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&e.url.includes("supabase.co")}function c(){let e=a(),r=n(),t=l(),s=i(t);return{currentBranch:e,environment:r,supabaseUrl:t.url,hasValidConfig:s,configSource:"production"===r?"production":"development-default"}}},2099:(e,r,t)=>{"use strict";t.d(r,{H:()=>i,k:()=>l});var s=t(4982),n=t(844);let a=null,l=()=>{if(a)return a;let e=(0,n.h9)();return a=(0,n.hV)(e)?(0,s.UU)(e.url,e.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}}):(0,s.UU)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}})},i=()=>{let e=(0,n.h9)();return(0,n.hV)(e)&&e.serviceRoleKey&&"placeholder-service-role-key"!==e.serviceRoleKey?(0,s.UU)(e.url,e.serviceRoleKey,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,s.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}})}},4778:(e,r,t)=>{Promise.resolve().then(t.bind(t,6739))},6739:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(5155),n=t(2115),a=t(4110),l=t(2099);let i=["7:00","8:00","9:00","12:00","15:00","16:00","17:00","18:00","19:00","20:00"],c=["8:00","9:00","10:00","11:00","12:00","14:00","16:00","17:00","18:00","19:00","20:00"],d={"7:00":"Early morning","8:00":"Before school/work","9:00":"Morning","12:00":"Lunch time","15:00":"After school","16:00":"Late afternoon","17:00":"Before dinner","18:00":"Dinner time","19:00":"After dinner","20:00":"Evening","21:00":"Late evening"};function o(e){let{relationshipId:r,currentUserId:t,dayType:o,existingPreferences:m=[],timeSlots:u,onPreferencesUpdated:h}=e,[p,f]=(0,n.useState)(!1),[x,b]=(0,n.useState)(null),[y,g]=(0,n.useState)(!1),[N,v]=(0,n.useState)([]),I=(0,l.k)(),j=u||("weekday"===o?i:c);(0,n.useEffect)(()=>{v(m.filter(e=>e.dayType===o).map(e=>e.time))},[m,o]);let k=e=>{let[r,t]=e.split(":"),s=parseInt(r);return"".concat(0===s?12:s>12?s-12:s,":").concat(t," ").concat(s>=12?"PM":"AM")},S=e=>d[e]||"",w=(e,r)=>{r?v(r=>[...r,e]):v(r=>r.filter(r=>r!==e))},E=async e=>{f(!0),b(null);try{let s=e.map((e,s)=>({relationshipId:r,userId:t,time:e.id,dayType:o,priority:s+1,context:S(e.id)}));await I.from("handoff_time_preferences").delete().eq("relationshipId",r).eq("userId",t).eq("dayType",o);let{error:n}=await I.from("handoff_time_preferences").insert(s);if(n)throw n;if(h){let e=s.map((e,r)=>({...e,id:"temp-".concat(r),createdAt:new Date,updatedAt:new Date}));h(e)}g(!1)}catch(e){b("Error saving handoff time preferences. Please try again."),console.error("Error saving handoff time preferences:",e)}finally{f(!1)}};if(y){let e=(()=>{let e=m.filter(e=>e.dayType===o).reduce((e,r)=>(e[r.time]=r,e),{});return N.sort((r,t)=>{let s=e[r],n=e[t];return s&&n?s.priority-n.priority:s?-1:n?1:r.localeCompare(t)}).map(e=>({id:e,label:k(e),description:S(e),metadata:{time:e,dayType:o}}))})();return(0,s.jsxs)("div",{className:"space-y-4",children:[p&&(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,s.jsx)("p",{className:"text-blue-800",children:"Saving your preferences..."})}),x&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,s.jsx)("p",{className:"text-red-800",children:x})}),(0,s.jsx)("button",{onClick:()=>{g(!1),b(null)},className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center",disabled:p,children:"← Back to Time Selection"}),(0,s.jsx)(a.S,{items:e,onSortComplete:E,title:"Sort Your ".concat("weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"),description:"Choose which handoff time you prefer when given the option. Your most preferred time will be ranked first."})]})}return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"]}),(0,s.jsx)("p",{className:"text-gray-600",children:"Select your preferred handoff times and sort them by preference to help with custody scheduling."})]}),x&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,s.jsx)("p",{className:"text-red-800",children:x})}),(0,s.jsxs)("div",{"data-testid":"time-selector",className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Select Preferred Handoff Times"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:j.map(e=>(0,s.jsxs)("label",{className:"\n                flex items-center space-x-2 p-3 rounded-lg border cursor-pointer transition-colors\n                ".concat(N.includes(e)?"bg-blue-50 border-blue-300 text-blue-900":"bg-white border-gray-200 hover:bg-gray-50","\n              "),children:[(0,s.jsx)("input",{type:"checkbox",checked:N.includes(e),onChange:r=>w(e,r.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","data-testid":"time-".concat(e)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium",children:k(e)}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:S(e)})]})]},e))}),(0,s.jsxs)("div",{"data-testid":"selected-times",className:"mt-4",children:[(0,s.jsxs)("h3",{className:"text-md font-medium mb-2",children:["Selected Times (",N.length,")"]}),N.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>(0,s.jsxs)("span",{"data-testid":"selected-".concat(e),className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[k(e),(0,s.jsx)("button",{onClick:()=>w(e,!1),className:"ml-2 text-blue-600 hover:text-blue-800","aria-label":"Remove ".concat(k(e)),children:"\xd7"})]},e))}):(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No times selected"})]}),(0,s.jsx)("button",{onClick:()=>{if(N.length<2)return void b("Please select at least 2 handoff times to sort.");g(!0),b(null)},disabled:N.length<2||p,"data-testid":"start-sorting",className:"\n            w-full py-3 px-4 rounded-md font-medium transition-colors\n            ".concat(N.length>=2&&!p?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n          "),children:p?"Saving...":"Start Sorting Preferences"}),N.length<2&&(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Select at least 2 handoff times to enable sorting"})]})]})}let m={relationshipId:"rel-123",currentUserId:"user-123"};function u(){let[e,r]=(0,n.useState)([]),[t,a]=(0,n.useState)(!0),i=(0,l.k)();(0,n.useEffect)(()=>{c()},[]);let c=async()=>{try{a(!0);let{data:e}=await i.from("handoff_time_preferences").select("*").eq("relationshipId",m.relationshipId).eq("userId",m.currentUserId);r(e||[])}catch(e){console.warn("Could not load preferences (demo mode):",e)}finally{a(!1)}},d=r=>e.filter(e=>e.dayType===r),u=(e,t)=>{r(r=>[...r.filter(e=>e.dayType!==t),...e])};return t?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading your preferences..."})]})})}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Handoff Time Preferences"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Set your preferred handoff times for weekdays and weekends."})]}),(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[(0,s.jsx)("span",{className:"mr-2",children:"\uD83D\uDCC5"}),"Weekdays"]}),(0,s.jsx)(o,{relationshipId:m.relationshipId,currentUserId:m.currentUserId,dayType:"weekday",existingPreferences:d("weekday"),onPreferencesUpdated:e=>u(e,"weekday")})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[(0,s.jsx)("span",{className:"mr-2",children:"\uD83C\uDF89"}),"Weekends"]}),(0,s.jsx)(o,{relationshipId:m.relationshipId,currentUserId:m.currentUserId,dayType:"weekend",existingPreferences:d("weekend"),onPreferencesUpdated:e=>u(e,"weekend")})]})]})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[277,982,804,796,110,441,684,358],()=>r(4778)),_N_E=e.O()}]);