"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{285:(e,t,n)=>{n.d(t,{$:()=>c});var i=n(5155),a=n(2115),r=n(4624),o=n(2085),s=n(9434);let l=(0,o.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:n,variant:a,size:o,asChild:c=!1,...d}=e,u=c?r.DX:"button";return(0,i.jsx)(u,{className:(0,s.cn)(l({variant:a,size:o,className:n})),ref:t,...d})});c.displayName="Button"},2085:(e,t,n)=>{n.d(t,{F:()=>o});var i=n(2596);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=i.$,o=(e,t)=>n=>{var i;if((null==t?void 0:t.variants)==null)return r(e,null==n?void 0:n.class,null==n?void 0:n.className);let{variants:o,defaultVariants:s}=t,l=Object.keys(o).map(e=>{let t=null==n?void 0:n[e],i=null==s?void 0:s[e];if(null===t)return null;let r=a(t)||a(i);return o[e][r]}),c=n&&Object.entries(n).reduce((e,t)=>{let[n,i]=t;return void 0===i||(e[n]=i),e},{});return r(e,l,null==t||null==(i=t.compoundVariants)?void 0:i.reduce((e,t)=>{let{class:n,className:i,...a}=t;return Object.entries(a).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...s,...c}[t]):({...s,...c})[t]===n})?[...e,n,i]:e},[]),null==n?void 0:n.class,null==n?void 0:n.className)}},4383:(e,t,n)=>{n.d(t,{Y:()=>r});var i=n(9509);class a{async sendInvitationEmail(e){let t="Co-parenting invitation from ".concat(e.inviter_name),n=this.generateInvitationEmailContent(e);console.log("--- EMAIL WOULD BE SENT ---"),console.log("To: ".concat(e.invitee_email)),console.log("From: ".concat(e.inviter_email)),console.log("Subject: ".concat(t)),console.log("Content:\n".concat(n)),console.log("--- END EMAIL ---")}async sendEmail(e,t,n){console.log("--- EMAIL WOULD BE SENT ---"),console.log("To: ".concat(e)),console.log("Subject: ".concat(t)),console.log("Content:\n".concat(n)),console.log("--- END EMAIL ---")}generateInvitationEmailContent(e){let t="".concat(i.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000","/invite?code=").concat(e.invitation_code);return"\nHi there!\n\n".concat(e.inviter_name," (").concat(e.inviter_email,") has invited you to join CoParent.Online to co-parent ").concat(e.child_name,".\n\nBenefits of joining CoParent.Online:\n• Share schedules and coordinate custody seamlessly\n• Track shared expenses and manage finances together  \n• Manage your child's inventory and belongings\n• Communicate effectively through our platform\n• Access mediation tools for resolving conflicts\n\n").concat(e.message?"Personal message from ".concat(e.inviter_name,':\n"').concat(e.message,'"\n\n'):"","\n\nTo accept this invitation, click the link below:\n").concat(t,"\n\nThis invitation will expire on ").concat(new Date(e.expires_at).toLocaleDateString(),".\n\nIf you already have an account, simply log in and the invitation will be processed automatically.\n\nIf you don't have an account yet, you'll be guided through a quick signup process.\n\nBest regards,\nThe CoParent.Online Team\n\n---\nIf you did not expect this invitation or believe this was sent in error, you can safely ignore this email.\n    ").trim()}}function r(){return new a}},4624:(e,t,n)=>{n.d(t,{DX:()=>o});var i=n(2115);function a(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var r=n(5155),o=function(e){let t=function(e){let t=i.forwardRef((e,t)=>{let{children:n,...r}=e;if(i.isValidElement(n)){var o;let e,s,l=(o=n,(s=(e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?o.ref:(s=(e=Object.getOwnPropertyDescriptor(o,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?o.props.ref:o.props.ref||o.ref),c=function(e,t){let n={...t};for(let i in t){let a=e[i],r=t[i];/^on[A-Z]/.test(i)?a&&r?n[i]=(...e)=>{let t=r(...e);return a(...e),t}:a&&(n[i]=a):"style"===i?n[i]={...a,...r}:"className"===i&&(n[i]=[a,r].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==i.Fragment&&(c.ref=t?function(...e){return t=>{let n=!1,i=e.map(e=>{let i=a(e,t);return n||"function"!=typeof i||(n=!0),i});if(n)return()=>{for(let t=0;t<i.length;t++){let n=i[t];"function"==typeof n?n():a(e[t],null)}}}}(t,l):l),i.cloneElement(n,c)}return i.Children.count(n)>1?i.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),n=i.forwardRef((e,n)=>{let{children:a,...o}=e,s=i.Children.toArray(a),c=s.find(l);if(c){let e=c.props.children,a=s.map(t=>t!==c?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,r.jsx)(t,{...o,ref:n,children:i.isValidElement(e)?i.cloneElement(e,void 0,a):null})}return(0,r.jsx)(t,{...o,ref:n,children:a})});return n.displayName=`${e}.Slot`,n}("Slot"),s=Symbol("radix.slottable");function l(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===s}},5695:(e,t,n)=>{var i=n(8999);n.o(i,"usePathname")&&n.d(t,{usePathname:function(){return i.usePathname}}),n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}}),n.o(i,"useSearchParams")&&n.d(t,{useSearchParams:function(){return i.useSearchParams}})},6695:(e,t,n)=>{n.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>o,aR:()=>s});var i=n(5155),a=n(2115),r=n(9434);let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});o.displayName="Card";let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",n),...a})});s.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,i.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,i.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",n),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",n),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",n),...a})}).displayName="CardFooter"},9434:(e,t,n)=>{n.d(t,{DT:()=>o,Fd:()=>c,Uj:()=>s,cn:()=>r,wz:()=>l});var i=n(2596),a=n(9688);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.QP)((0,i.$)(t))}function o(){return"/pr-92"}function s(e){let t=o(),n=e.startsWith("/")?"".concat(t).concat(e):e;window.location.href=n}function l(e,t){return e===t||("/"===t?"/"===e:e.startsWith(t+"/")||e===t)}function c(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:"/".concat(e):"/"}},9454:(e,t,n)=>{n.d(t,{n:()=>s});var i=n(3579),a=n(2099),r=n(4383);class o{async sendInvitation(e){let{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)throw Error("User not authenticated");let{data:i,error:a}=await this.supabase.from("users").select("full_name, email").eq("id",t.id).single();if(a||!i)throw Error("Failed to get user information");let{data:r,error:o}=await this.supabase.from("children").select("name").eq("id",e.child_id).single();if(o||!r)throw Error("Failed to get child information");let{data:s}=await this.supabase.from("co_parent_invitations").select("id, status").eq("inviter_id",t.id).eq("invitee_email",e.invitee_email).eq("child_id",e.child_id).eq("status","pending").single();if(s)throw Error("An invitation is already pending for this email and child");let{data:l,error:c}=await this.supabase.from("co_parent_invitations").insert({inviter_id:t.id,invitee_email:e.invitee_email,child_id:e.child_id}).select().single();if(c||!l)throw Error("Failed to create invitation");let d={inviter_name:i.full_name,inviter_email:i.email,invitee_email:e.invitee_email,child_name:r.name,invitation_code:l.invitation_code,expires_at:l.expires_at,message:e.message};try{await this.sendInvitationEmail(d)}catch(e){console.error("Failed to send invitation email:",e)}return l}async sendBulkInvitation(e){let{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)throw Error("User not authenticated");let{data:i,error:a}=await this.supabase.from("users").select("full_name, email").eq("id",t.id).single();if(a||!i)throw Error("Failed to get user information");let{data:r,error:o}=await this.supabase.from("children").select("id, name").in("id",e.child_ids);if(o||!r)throw Error("Failed to get children information");let{data:s}=await this.supabase.from("co_parent_invitations").select("child_id").eq("inviter_id",t.id).eq("invitee_email",e.invitee_email).in("child_id",e.child_ids).eq("status","pending");if(s&&s.length>0){let e=s.map(e=>e.child_id),t=r.filter(t=>e.includes(t.id)).map(e=>e.name);throw Error("Invitations are already pending for: ".concat(t.join(", ")))}let l=e.child_ids.map(n=>({inviter_id:t.id,invitee_email:e.invitee_email,child_id:n})),{data:c,error:d}=await this.supabase.from("co_parent_invitations").insert(l).select();if(d||!c)throw Error("Failed to create invitations");let u=r.map(e=>e.name),f={inviter_name:i.full_name,inviter_email:i.email,invitee_email:e.invitee_email,child_name:1===u.length?u[0]:u.join(", "),invitation_code:c[0].invitation_code,expires_at:c[0].expires_at,message:e.message};try{await this.sendInvitationEmail(f)}catch(e){console.error("Failed to send invitation email:",e)}return c}async getInvitations(e){let{data:t,error:n}=await this.supabase.from("co_parent_invitations").select("\n        *,\n        children(name),\n        users!inviter_id(full_name, email)\n      ").eq("inviter_id",e).order("created_at",{ascending:!1});if(n)throw Error("Failed to fetch invitations");return t||[]}async getReceivedInvitations(e){let{data:t,error:n}=await this.supabase.from("co_parent_invitations").select("\n        *,\n        children(name),\n        users!inviter_id(full_name, email)\n      ").eq("invitee_email",e).eq("status","pending").order("created_at",{ascending:!1});if(n)throw Error("Failed to fetch received invitations");return t||[]}async acceptInvitation(e){let{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)throw Error("User not authenticated");let{data:i,error:a}=await this.supabase.from("users").select("email").eq("id",t.id).single();if(a||!i)throw Error("Failed to get user information");let{data:r,error:o}=await this.supabase.from("co_parent_invitations").select("*").eq("invitation_code",e).eq("invitee_email",i.email).eq("status","pending").single();if(o||!r)throw Error("Invitation not found or already processed");if(new Date(r.expires_at)<new Date)throw await this.supabase.from("co_parent_invitations").update({status:"expired"}).eq("id",r.id),Error("Invitation has expired");let{error:s}=await this.supabase.from("co_parent_relationships").insert({child_id:r.child_id,parent_a_id:r.inviter_id,parent_b_id:t.id});if(s)throw Error("Failed to create co-parent relationship");let{error:l}=await this.supabase.from("co_parent_invitations").update({status:"accepted",accepted_at:new Date().toISOString()}).eq("id",r.id);if(l)throw Error("Failed to update invitation status")}async rejectInvitation(e){let{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)throw Error("User not authenticated");let{data:i,error:a}=await this.supabase.from("users").select("email").eq("id",t.id).single();if(a||!i)throw Error("Failed to get user information");let{error:r}=await this.supabase.from("co_parent_invitations").update({status:"rejected"}).eq("invitation_code",e).eq("invitee_email",i.email).eq("status","pending");if(r)throw Error("Failed to reject invitation")}async sendInvitationEmail(e){let t=(0,r.Y)();await t.sendInvitationEmail(e)}constructor(){this.supabase=(()=>{try{return(0,i.createClientComponentClient)()}catch(e){return(0,a.k)()}})()}}let s=new o},9657:(e,t,n)=>{n.d(t,{_:()=>r});var i=n(2115),a=n(9454);function r(){let[e,t]=(0,i.useState)(!1),[n,r]=(0,i.useState)(null),o=(0,i.useCallback)(async e=>{t(!0),r(null);try{return await a.n.sendInvitation(e)}catch(e){return r(e instanceof Error?e.message:"Failed to send invitation"),null}finally{t(!1)}},[]),s=(0,i.useCallback)(async e=>{t(!0),r(null);try{return await a.n.sendBulkInvitation(e)}catch(e){return r(e instanceof Error?e.message:"Failed to send invitations"),null}finally{t(!1)}},[]);return{sendInvitation:o,sendBulkInvitation:s,acceptInvitation:(0,i.useCallback)(async e=>{t(!0),r(null);try{return await a.n.acceptInvitation(e),!0}catch(e){return r(e instanceof Error?e.message:"Failed to accept invitation"),!1}finally{t(!1)}},[]),rejectInvitation:(0,i.useCallback)(async e=>{t(!0),r(null);try{return await a.n.rejectInvitation(e),!0}catch(e){return r(e instanceof Error?e.message:"Failed to reject invitation"),!1}finally{t(!1)}},[]),loading:e,error:n,clearError:()=>r(null)}}}}]);