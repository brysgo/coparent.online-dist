"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[83],{844:(e,t,i)=>{i.d(t,{GY:()=>u,h9:()=>n,hV:()=>o});var r=i(9509);function a(){let e=s();return"main"===e||"master"===e||"production"===e?"production":"development"}function s(){return"copilot/fix-82"}function n(){if("production"===a())return{url:r.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",anonKey:r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-anon-key",serviceRoleKey:r.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};{let e=r.env.SUPABASE_DEV_URL||"https://bqiapoplmkkrtnsmmxhs.supabase.co";return{url:e,anonKey:r.env.SUPABASE_DEV_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDA3OTMsImV4cCI6MjA2ODAxNjc5M30.bZGNGvb8XYZSWkbfMYMNBAzoedp4SGOIerHmNcRqUsk",serviceRoleKey:r.env.SUPABASE_DEV_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjQ0MDc5MywiZXhwIjoyMDY4MDE2NzkzfQ.7m9y2vqrq1Sd8bX6dl6A47WQbZoQHGKc7o2rzrcTjKI"}}}function o(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&(e.url.includes("supabase.co")||e.url.includes("127.0.0.1"))}function u(){let e=s(),t=a(),i=n(),r=o(i);return{currentBranch:e,environment:t,supabaseUrl:i.url,hasValidConfig:r,configSource:"production"===t?"production":"development-default"}}},2099:(e,t,i)=>{i.d(t,{k:()=>n});var r=i(4982),a=i(844);let s=null,n=()=>{if(s)return s;let e=(0,a.h9)();return s=(0,a.hV)(e)?(0,r.UU)(e.url,e.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}}):(0,r.UU)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}})}},6083:(e,t,i)=>{i.d(t,{A:()=>l,O:()=>u});var r=i(5155),a=i(2115),s=i(2099),n=i(844);let o=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[i,u]=(0,a.useState)({user:null,isLoading:!0,isAuthenticated:!1}),l=(0,s.k)();(0,a.useEffect)(()=>{if(!l)return;c();let{data:{subscription:e}}=l.auth.onAuthStateChange(async(e,t)=>{"SIGNED_IN"===e&&(null==t?void 0:t.user)?await d(t.user.id):"SIGNED_OUT"===e?u({user:null,isLoading:!1,isAuthenticated:!1}):"TOKEN_REFRESHED"===e&&(null==t||t.user)});return()=>e.unsubscribe()},[]);let c=async()=>{if(l)try{let{data:{session:e},error:t}=await l.auth.getSession();if(t){console.error("Failed to get session:",t),u(e=>({...e,isLoading:!1}));return}(null==e?void 0:e.user)?await d(e.user.id):u(e=>({...e,isLoading:!1}))}catch(e){console.error("Failed to initialize auth:",e),u(e=>({...e,isLoading:!1}))}},d=async e=>{var t,i,r,a;if(l)try{let{data:{session:a}}=await l.auth.getSession();if(!(null==a?void 0:a.user)){console.warn("No valid session found, signing out"),await p();return}let{data:s,error:n}=await l.from("users").select("*").eq("id",e).single();if(n){if(console.error("Failed to load user profile from database:",n),"42P01"===n.code||(null==(t=n.message)?void 0:t.includes("relation"))||(null==(i=n.message)?void 0:i.includes("does not exist"))){console.warn("Database tables missing, creating fallback user profile");let e={id:a.user.id,email:a.user.email||"",full_name:(null==(r=a.user.user_metadata)?void 0:r.full_name)||a.user.email||"User",credit_score:100,created_at:a.user.created_at,updated_at:new Date().toISOString()};u({user:e,isLoading:!1,isAuthenticated:!0});return}throw n}u({user:s,isLoading:!1,isAuthenticated:!0})}catch(t){console.error("Failed to load user profile:",t);let{data:{session:e}}=await l.auth.getSession().catch(()=>({data:{session:null}}));(null==e?void 0:e.user)?(console.warn("Database error but session valid, using fallback user"),u({user:{id:e.user.id,email:e.user.email||"",full_name:(null==(a=e.user.user_metadata)?void 0:a.full_name)||e.user.email||"User",credit_score:100,created_at:e.user.created_at,updated_at:new Date().toISOString()},isLoading:!1,isAuthenticated:!0})):u({user:null,isLoading:!1,isAuthenticated:!1})}},h=async(e,t)=>{if(!l)throw Error("Supabase client not available");try{u(e=>({...e,isLoading:!0}));let i=(0,n.h9)();console.log("Attempting sign in with config:",{url:i.url,hasAnonKey:!!i.anonKey,configSource:(0,n.GY)()});let{data:r,error:a}=await l.auth.signInWithPassword({email:e,password:t});if(a)throw a;if(!r.user)throw Error("No user returned from sign in");await d(r.user.id)}catch(e){throw u(e=>({...e,isLoading:!1})),e}},f=async(e,t,i)=>{if(!l)throw Error("Supabase client not available");try{u(e=>({...e,isLoading:!0}));let{data:r,error:a}=await l.auth.signUp({email:e,password:t,options:{data:{full_name:i}}});if(a)throw a;if(!r.user)throw Error("No user returned from sign up");let{error:s}=await l.from("users").insert({id:r.user.id,email:e,full_name:i,credit_score:100});if(s)throw s;await d(r.user.id)}catch(e){throw u(e=>({...e,isLoading:!1})),e}},p=async()=>{if(l)try{await l.auth.signOut(),u({user:null,isLoading:!1,isAuthenticated:!1})}catch(e){console.error("Failed to sign out:",e)}},w=async()=>{if(l)try{var e;let{data:t,error:i}=await l.auth.refreshSession();if(i)throw i;(null==(e=t.session)?void 0:e.user)&&await d(t.session.user.id)}catch(e){console.error("Failed to refresh session:",e),await p()}},I={...i,signIn:h,signUp:f,signOut:p,refreshSession:w};return(0,r.jsx)(o.Provider,{value:I,children:t})}function l(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);