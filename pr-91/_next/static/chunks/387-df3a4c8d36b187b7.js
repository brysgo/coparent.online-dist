"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[387],{387:(e,t,r)=>{r.d(t,{Q:()=>d});var a=r(5155),s=r(2115),n=r(4110),i=r(285),o=r(6695);function l(e){let{selectedDates:t,onDatesChange:r,onStartSorting:n,holidayData:l={}}=e,[c,d]=(0,s.useState)(""),p=e=>{let a=new Date;if(a.setHours(0,0,0,0),e<a)return;let s=e.toISOString().split("T")[0];t.map(e=>e.toISOString().split("T")[0]).includes(s)||r([...t,e])},h=e=>{r(t.filter(t=>t.toISOString()!==e.toISOString()))},m=e=>{let t=l[e.toISOString().split("T")[0]];return t?"".concat(t," (").concat(e.toLocaleDateString(),")"):e.toLocaleDateString()},u=[{date:new Date("2024-12-25"),label:"Christmas Day"},{date:new Date("2024-01-01"),label:"New Year's Day"},{date:new Date("2024-07-04"),label:"Independence Day"},{date:new Date("2024-11-28"),label:"Thanksgiving"},{date:new Date("2024-10-31"),label:"Halloween"},{date:new Date("2024-02-14"),label:"Valentine's Day"}].filter(e=>{let t=new Date;return t.setHours(0,0,0,0),e.date>=t});return(0,a.jsxs)(o.Zp,{className:"w-full max-w-2xl mx-auto",children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsx)(o.ZB,{children:"Select Important Dates"}),(0,a.jsx)(o.BT,{children:"Choose the dates that are most important to you for having your child. You'll then sort them by priority."})]}),(0,a.jsxs)(o.Wu,{className:"space-y-6",children:[t.length>0&&(0,a.jsxs)("div",{"data-testid":"selected-dates",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium mb-2",children:["Selected Dates (",t.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{"data-testid":"selected-".concat(e.toISOString()),className:"flex items-center justify-between p-2 bg-blue-50 rounded-md",children:[(0,a.jsx)("span",{className:"text-sm",children:m(e)}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>h(e),className:"text-red-600 hover:text-red-800",children:"Remove"})]},e.toISOString()))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Common Important Dates"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:u.map(e=>{let r=t.some(t=>t.toISOString().split("T")[0]===e.date.toISOString().split("T")[0]);return(0,a.jsx)(i.$,{variant:r?"secondary":"outline",size:"sm",onClick:()=>p(e.date),disabled:r,className:"text-xs",children:e.label},e.date.toISOString())})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Add Custom Date"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"date",value:c,onChange:e=>d(e.target.value),min:new Date().toISOString().split("T")[0],className:"flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,a.jsx)(i.$,{onClick:()=>{c&&(p(new Date(c)),d(""))},disabled:!c,size:"sm",children:"Add Date"})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t",children:[(0,a.jsx)(i.$,{"data-testid":"start-sorting",onClick:n,disabled:t.length<2,className:"w-full",size:"lg",children:t.length<2?"Select at least 2 dates to start sorting (".concat(t.length,"/2)"):"Start Sorting ".concat(t.length," Dates")}),t.length>=2&&(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2 text-center",children:"You'll compare dates to determine which are most important to you"})]})]})]})}var c=r(7926);function d(e){let{relationshipId:t,currentUserId:r,selectedDates:i=[],existingPreferences:o=[],holidayData:d={},onPreferencesUpdated:p}=e,[h,m]=(0,s.useState)(i),[u,f]=(0,s.useState)(!1),[y,x]=(0,s.useState)(!1),[g,b]=(0,s.useState)(null),S=e=>{let t=new Date;return t.setHours(0,0,0,0),e.filter(e=>{let r=new Date(e);return r.setHours(0,0,0,0),r>=t})},w=async e=>{x(!0),b(null);try{let a=e.map((e,t)=>({date:e.id,priority:t+1}));await c.t.saveDatePreferences(r,t,a),f(!1),p&&p()}catch(e){b("Error saving preferences. Please try again."),console.error("Error saving date preferences:",e)}finally{x(!1)}},v=()=>{f(!1)};if(u){let e=(e=>{let t=S(e).map(e=>{let t=e.toISOString().split("T")[0],r=d[t];return{id:t,label:r||e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),description:r?e.toLocaleDateString():void 0,metadata:{date:t,isHoliday:!!r}}});if(o.length>0){let e=new Map(o.map(e=>[e.date,e.priority]));t.sort((t,r)=>(e.get(t.id)||999)-(e.get(r.id)||999))}return t})(h);return e.length<2?(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"No Future Dates to Sort"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"All selected dates are in the past. Please select future dates to sort."}),(0,a.jsx)("button",{onClick:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Back to Date Selection"})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[g&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:g}),(0,a.jsx)(n.S,{items:e,onSortComplete:w,title:"Sort Your Date Preferences",description:"Compare pairs of dates to determine which are most important to you for having your child."}),y&&(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsxs)("div",{className:"inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving preferences..."]})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:v,className:"text-blue-600 hover:text-blue-800 text-sm",disabled:y,children:"← Back to Date Selection"})})]})}return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Date Preference Sorting"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Select important dates and sort them by priority to help with custody scheduling."})]}),(0,a.jsx)(l,{selectedDates:h,onDatesChange:m,onStartSorting:()=>{f(!0)},holidayData:d}),o.length>0&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Your Current Preferences"}),(0,a.jsx)("div",{className:"space-y-1",children:o.sort((e,t)=>e.priority-t.priority).map((e,t)=>{let r=d[e.date],s=new Date(e.date),n=r||s.toLocaleDateString();return(0,a.jsxs)("div",{className:"text-sm text-blue-800",children:[t+1,". ",n]},e.date)})})]})]})}},844:(e,t,r)=>{r.d(t,{GY:()=>l,h9:()=>i,hV:()=>o});var a=r(9509);function s(){let e=n();return"main"===e||"master"===e||"production"===e?"production":"development"}function n(){return"copilot/fix-82"}function i(){if("production"===s())return{url:a.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",anonKey:a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-anon-key",serviceRoleKey:a.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};{let e=a.env.SUPABASE_DEV_URL||"https://bqiapoplmkkrtnsmmxhs.supabase.co";return{url:e,anonKey:a.env.SUPABASE_DEV_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDA3OTMsImV4cCI6MjA2ODAxNjc5M30.bZGNGvb8XYZSWkbfMYMNBAzoedp4SGOIerHmNcRqUsk",serviceRoleKey:a.env.SUPABASE_DEV_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjQ0MDc5MywiZXhwIjoyMDY4MDE2NzkzfQ.7m9y2vqrq1Sd8bX6dl6A47WQbZoQHGKc7o2rzrcTjKI"}}}function o(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&(e.url.includes("supabase.co")||e.url.includes("127.0.0.1"))}function l(){let e=n(),t=s(),r=i(),a=o(r);return{currentBranch:e,environment:t,supabaseUrl:r.url,hasValidConfig:a,configSource:"production"===t?"production":"development-default"}}},2099:(e,t,r)=>{r.d(t,{H:()=>o,k:()=>i});var a=r(4982),s=r(844);let n=null,i=()=>{if(n)return n;let e=(0,s.h9)();return n=(0,s.hV)(e)?(0,a.UU)(e.url,e.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}}):(0,a.UU)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}})},o=()=>{let e=(0,s.h9)();return(0,s.hV)(e)&&e.serviceRoleKey&&"placeholder-service-role-key"!==e.serviceRoleKey?(0,a.UU)(e.url,e.serviceRoleKey,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,a.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}})}},7926:(e,t,r)=>{r.d(t,{t:()=>n});var a=r(2099);class s{async getUserPreferences(e,t){try{let{data:r,error:a}=await this.supabase.from("day_preferences").select("*").eq("parent_id",e).eq("relationship_id",t).order("priority",{ascending:!0});if(a)throw a;let{data:s,error:n}=await this.supabase.from("date_preferences").select("*").eq("parent_id",e).eq("relationship_id",t).order("priority",{ascending:!0});if(n)throw n;let{data:i,error:o}=await this.supabase.from("handoff_times").select("*").eq("relationship_id",t).order("time",{ascending:!0});if(o)throw o;return{dayPreferences:r||[],datePreferences:s||[],handoffTimes:i||[]}}catch(e){throw console.error("Error fetching user preferences:",e),Error("Failed to fetch user preferences")}}async saveDayPreferences(e,t,r){try{let{error:a}=await this.supabase.from("day_preferences").delete().eq("parent_id",e).eq("relationship_id",t);if(a)throw a;let s=r.map(r=>({relationship_id:t,parent_id:e,day_of_week:r.dayOfWeek,priority:r.priority})),{data:n,error:i}=await this.supabase.from("day_preferences").insert(s).select();if(i)throw i;return n||[]}catch(e){throw console.error("Error saving day preferences:",e),Error("Failed to save day preferences")}}async saveDatePreferences(e,t,r){try{let{error:a}=await this.supabase.from("date_preferences").delete().eq("parent_id",e).eq("relationship_id",t);if(a)throw a;let s=r.map(r=>({relationship_id:t,parent_id:e,date:r.date,priority:r.priority})),{data:n,error:i}=await this.supabase.from("date_preferences").insert(s).select();if(i)throw i;return n||[]}catch(e){throw console.error("Error saving date preferences:",e),Error("Failed to save date preferences")}}async saveHandoffTimePreferences(e,t){try{let{error:r}=await this.supabase.from("handoff_times").delete().eq("relationship_id",e);if(r)throw r;let a=t.map(t=>({relationship_id:e,time:t.time,priority_parent_a:t.priorityParentA,priority_parent_b:t.priorityParentB})),{data:s,error:n}=await this.supabase.from("handoff_times").insert(a).select();if(n)throw n;return s||[]}catch(e){throw console.error("Error saving handoff time preferences:",e),Error("Failed to save handoff time preferences")}}async getRelationshipPreferenceSummary(e){try{let{data:t,error:r}=await this.supabase.from("co_parent_relationships").select("parent_a_id, parent_b_id").eq("id",e).single();if(r)throw r;let a=await this.getUserPreferenceSummary(t.parent_a_id,e),s=await this.getUserPreferenceSummary(t.parent_b_id,e);return{parentA:a,parentB:s}}catch(e){return console.error("Error fetching relationship preference summary:",e),{parentA:null,parentB:null}}}async getUserPreferenceSummary(e,t){try{let r=await this.getUserPreferences(e,t),a=r.dayPreferences.sort((e,t)=>e.priority-t.priority).map(e=>e.day_of_week),s=r.handoffTimes.map(r=>({time:r.time,priority:e===t?r.priority_parent_a:r.priority_parent_b})).sort((e,t)=>e.priority-t.priority).map(e=>e.time),n=r.datePreferences.sort((e,t)=>e.priority-t.priority).map(e=>e.date),i=[...r.dayPreferences.map(e=>e.updated_at),...r.datePreferences.map(e=>e.updated_at),...r.handoffTimes.map(e=>e.updated_at)],o=i.length>0?i.sort().reverse()[0]:new Date().toISOString();return{userId:e,relationshipId:t,preferredDays:a,preferredTimes:s,importantDates:n,lastUpdated:o}}catch(e){return console.error("Error getting user preference summary:",e),null}}async hasPreferences(e,t){try{let r=await this.getUserPreferences(e,t);return r.dayPreferences.length>0||r.datePreferences.length>0||r.handoffTimes.length>0}catch(e){return console.error("Error checking if preferences exist:",e),!1}}async getPreferenceConflicts(e){try{let t=await this.getRelationshipPreferenceSummary(e);if(!t.parentA||!t.parentB)return{dayConflicts:[],timeConflicts:[],dateConflicts:[]};let r=[];for(let e=0;e<=6;e++){let a=t.parentA.preferredDays.indexOf(e),s=t.parentB.preferredDays.indexOf(e);-1!==a&&-1!==s&&a<3&&s<3&&r.push({day:e,parentAPrefs:a+1,parentBPrefs:s+1})}let a=[];for(let e of t.parentA.preferredTimes.filter(e=>t.parentB.preferredTimes.includes(e))){let r=t.parentA.preferredTimes.indexOf(e),s=t.parentB.preferredTimes.indexOf(e);a.push({time:e,parentAPrefs:r+1,parentBPrefs:s+1})}let s=[];for(let e of t.parentA.importantDates.filter(e=>t.parentB.importantDates.includes(e)))s.push({date:e,bothWant:!0});return{dayConflicts:r,timeConflicts:a,dateConflicts:s}}catch(e){return console.error("Error analyzing preference conflicts:",e),{dayConflicts:[],timeConflicts:[],dateConflicts:[]}}}constructor(e=!1){e?this.supabase=null:this.supabase=(0,a.k)()}}let n=new s}}]);