(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{2523:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(5155),r=t(2115),i=t(9434);let n=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","border-gray-300 bg-white placeholder:text-gray-400 focus-visible:ring-blue-500",t),ref:s,...n})});n.displayName="Input"},5057:(e,s,t)=>{"use strict";t.d(s,{J:()=>n});var a=t(5155),r=t(2115),i=t(9434);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("label",{ref:s,className:(0,i.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70","text-gray-700",t),...r})});n.displayName="Label"},6952:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N});var a=t(5155),r=t(6083),i=t(2115),n=t(5695),l=t(6874),d=t.n(l),c=t(285),x=t(6695),o=t(2523),h=t(5057),m=t(8539),u=t(9657),g=t(2099);function p(e){let{onSuccess:s}=e,[t,r]=(0,i.useState)(""),[n,l]=(0,i.useState)([]),[d,p]=(0,i.useState)(""),[j,f]=(0,i.useState)([]),[y,b]=(0,i.useState)(!0),{sendBulkInvitation:v,loading:N,error:w,clearError:_}=(0,u._)(),k=(0,g.k)();(0,i.useEffect)(()=>{S()},[]),(0,i.useEffect)(()=>{if(w){let e=setTimeout(()=>{_()},5e3);return()=>clearTimeout(e)}},[w,_]);let S=async()=>{try{let{data:{user:e}}=await k.auth.getUser();if(!e)return;let{data:s,error:t}=await k.from("children").select("id, name").order("name");if(t)throw t;f(s||[])}catch(e){console.error("Failed to load children:",e)}finally{b(!1)}},C=async e=>{e.preventDefault(),t&&0!==n.length&&await v({invitee_email:t,child_ids:n,message:d||void 0})&&(r(""),l([]),p(""),null==s||s())},D=e=>{l(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])};return y?(0,a.jsx)(x.Zp,{className:"w-full max-w-md",children:(0,a.jsx)(x.Wu,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading..."})})}):(0,a.jsxs)(x.Zp,{className:"w-full max-w-md",children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Invite Co-Parent"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(h.J,{htmlFor:"email",children:"Co-Parent Email"}),(0,a.jsx)(o.p,{id:"email",type:"email",value:t,onChange:e=>r(e.target.value),placeholder:"Enter their email address",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(h.J,{htmlFor:"children",children:"Children"}),(0,a.jsx)("div",{className:"mt-2 space-y-2 border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto",children:0===j.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No children found"}):j.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"child-".concat(e.id),checked:n.includes(e.id),onChange:()=>D(e.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2"}),(0,a.jsx)("label",{htmlFor:"child-".concat(e.id),className:"text-sm font-medium text-gray-700 cursor-pointer",children:e.name})]},e.id))}),n.length>0&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[n.length," child",1!==n.length?"ren":""," selected"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(h.J,{htmlFor:"message",children:"Personal Message (Optional)"}),(0,a.jsx)(m.T,{id:"message",value:d,onChange:e=>p(e.target.value),placeholder:"Add a personal message to your invitation...",rows:3})]}),w&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:w})}),(0,a.jsx)(c.$,{type:"submit",disabled:N||!t||0===n.length,className:"w-full",children:N?"Sending Invitation...":"Send Invitation"})]})})]})}var j=t(6249);function f(){let[e,s]=(0,i.useState)(!1),[t,r]=(0,i.useState)([]),[n,l]=(0,i.useState)([]),[d,o]=(0,i.useState)(!0),[h,m]=(0,i.useState)(null),u=(0,g.k)();(0,i.useEffect)(()=>{f()},[]);let f=async()=>{try{o(!0);let{data:{user:e}}=await u.auth.getUser();if(!e)return;let{data:s}=await u.from("users").select("email").eq("id",e.id).single();if(m(s),null==s?void 0:s.email){let[t,a]=await Promise.all([j.n.getInvitations(e.id),j.n.getReceivedInvitations(s.email)]);r(t),l(a)}}catch(e){console.error("Failed to load invitations:",e)}finally{o(!1)}},y=e=>{switch(e){case"pending":return"text-yellow-600 bg-yellow-50";case"accepted":return"text-green-600 bg-green-50";case"rejected":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}};return d?(0,a.jsx)(x.Zp,{children:(0,a.jsx)(x.Wu,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading invitations..."})})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Co-Parent Connections"}),(0,a.jsx)(c.$,{onClick:()=>s(!0),children:"Invite Co-Parent"})]}),e&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Send Invitation"}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>s(!1),children:"\xd7"})]}),(0,a.jsx)(p,{onSuccess:()=>{s(!1),f()}})]})}),n.length>0&&(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Pending Invitations"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:n.map(e=>{var s,t;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Invitation from ",null==(s=e.users)?void 0:s.full_name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["To co-parent ",null==(t=e.children)?void 0:t.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Expires: ",new Date(e.expires_at).toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)(c.$,{size:"sm",onClick:()=>window.location.href="/invite?code=".concat(e.invitation_code),children:"View"})})]},e.id)})})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Sent Invitations"})}),(0,a.jsx)(x.Wu,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"No invitations sent yet."}),(0,a.jsx)("p",{className:"text-sm",children:"Invite your co-parent to start sharing schedules and data."})]}):(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>{var s;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["Invited ",e.invitee_email]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["For ",null==(s=e.children)?void 0:s.name]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Sent: ",new Date(e.created_at).toLocaleDateString()]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(y(e.status)),children:e.status})})]},e.id)})})})]})]})}class y{async getSharedDataSummary(e){try{let{data:s,error:t}=await this.supabase.from("co_parent_relationships").select("\n          id,\n          child_id,\n          parent_a_id,\n          parent_b_id,\n          time_ratio,\n          created_at,\n          children(id, name, date_of_birth)\n        ").or("parent_a_id.eq.".concat(e,",parent_b_id.eq.").concat(e));if(t)throw t;let a=[],r=[];if(s)for(let t of s){let s=t.parent_a_id===e?t.parent_b_id:t.parent_a_id,{data:i}=await this.supabase.from("users").select("full_name, email").eq("id",s).single();i&&t.children&&(a.push({id:t.id,child_id:t.child_id,partner_id:s,partner_name:i.full_name,partner_email:i.email,child_name:t.children.name,time_ratio:t.time_ratio,created_at:t.created_at}),r.find(e=>e.id===t.children.id)||r.push({id:t.children.id,name:t.children.name,date_of_birth:t.children.date_of_birth}))}let i=[{id:"1",type:"invitation",description:"Co-parent relationships established",created_at:new Date().toISOString(),created_by:e,created_by_name:"You"}];return{relationships:a,sharedChildren:r,recentActivity:i,pendingUpdates:0}}catch(e){return console.error("Failed to get shared data summary:",e),{relationships:[],sharedChildren:[],recentActivity:[],pendingUpdates:0}}}async getRealtimeUpdates(e){return[]}constructor(){this.supabase=(0,g.k)()}}let b=new y;function v(){let[e,s]=(0,i.useState)(null),[t,r]=(0,i.useState)(!0),[n,l]=(0,i.useState)(null),d=(0,g.k)();(0,i.useEffect)(()=>{c()},[]);let c=async()=>{try{let{data:{user:e}}=await d.auth.getUser();if(!e)return;l(e);let t=await b.getSharedDataSummary(e.id);s(t)}catch(e){console.error("Failed to load shared data:",e)}finally{r(!1)}};return t?(0,a.jsx)(x.Zp,{children:(0,a.jsx)(x.Wu,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading shared data..."})})}):e&&0!==e.relationships.length?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Shared Data & Real-time Updates"}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Connected Co-Parents"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:e.relationships.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.partner_name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Co-parenting ",e.child_name]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.partner_email})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-sm font-medium",children:["Time Ratio: ",e.time_ratio,"%"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Connected: ",new Date(e.created_at).toLocaleDateString()]})]})]},e.id))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Shared Children"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:e.sharedChildren.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Born: ",new Date(e.date_of_birth).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Age: ",Math.floor((Date.now()-new Date(e.date_of_birth).getTime())/315576e5)," years"]})]},e.id))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Recent Activity"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-xs text-green-600",children:"Real-time updates enabled"})]})]})})}),(0,a.jsx)(x.Wu,{children:0===e.recentActivity.length?(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500",children:[(0,a.jsx)("p",{children:"No recent activity"}),(0,a.jsx)("p",{className:"text-sm",children:"Updates will appear here when you or your co-parent make changes."})]}):(0,a.jsx)("div",{className:"space-y-3",children:e.recentActivity.map(e=>(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mt-1 ".concat("expense"===e.type?"bg-blue-500":"schedule"===e.type?"bg-green-500":"inventory"===e.type?"bg-purple-500":"bg-gray-500")}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm",children:e.description}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["by ",e.created_by_name," • ",new Date(e.created_at).toLocaleString()]})]})]},e.id))})})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Data Synchronization"})}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-green-600",children:"✓ All data synchronized"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Your data is automatically shared with connected co-parents"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Last sync: ",new Date().toLocaleTimeString()]})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:"✓"}),(0,a.jsx)("div",{className:"text-sm",children:"Calendar"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:"✓"}),(0,a.jsx)("div",{className:"text-sm",children:"Expenses"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:"✓"}),(0,a.jsx)("div",{className:"text-sm",children:"Inventory"})]})]})]})]})]}):(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"Shared Data"})}),(0,a.jsx)(x.Wu,{children:(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"No co-parent relationships established yet."}),(0,a.jsx)("p",{className:"text-sm",children:"Send an invitation to start sharing data with your co-parent."})]})})]})}function N(){let{user:e,isLoading:s,isAuthenticated:t}=(0,r.A)(),l=(0,n.useRouter)();return((0,i.useEffect)(()=>{s||t||l.push("/login")},[s,t,l]),s)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:["Welcome back, ",e.full_name,"!"]}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Here's your co-parenting dashboard. Manage your preferences, schedule, and more."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Preferences"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Set your scheduling preferences and priorities."}),(0,a.jsx)(d(),{href:"/preferences",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Preferences"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Calendar"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"View and manage your custody schedule."}),(0,a.jsx)(d(),{href:"/calendar",children:(0,a.jsx)(c.$,{className:"w-full",children:"View Calendar"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Inventory"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Track your child's belongings and equipment."}),(0,a.jsx)(d(),{href:"/inventory",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Inventory"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Situations"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Handle special situations and emergencies."}),(0,a.jsx)(d(),{href:"/situations",children:(0,a.jsx)(c.$,{className:"w-full",children:"Manage Situations"})})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Recent Activity"}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Welcome to CoParent.Online! Start by setting up your preferences."}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Just now"})]})})]}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8",children:(0,a.jsx)(f,{})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,a.jsx)(v,{})})]})}):null}},8539:(e,s,t)=>{"use strict";t.d(s,{T:()=>n});var a=t(5155),r=t(2115),i=t(9434);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50","border-gray-300 bg-white placeholder:text-gray-400 focus-visible:ring-blue-500",t),ref:s,...r})});n.displayName="Textarea"},9240:(e,s,t)=>{Promise.resolve().then(t.bind(t,6952))}},e=>{var s=s=>e(e.s=s);e.O(0,[277,982,874,83,877,441,684,358],()=>s(9240)),_N_E=e.O()}]);