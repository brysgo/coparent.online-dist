(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{5695:(e,t,a)=>{"use strict";var i=a(8999);a.o(i,"usePathname")&&a.d(t,{usePathname:function(){return i.usePathname}}),a.o(i,"useRouter")&&a.d(t,{useRouter:function(){return i.useRouter}}),a.o(i,"useSearchParams")&&a.d(t,{useSearchParams:function(){return i.useSearchParams}})},6249:(e,t,a)=>{"use strict";a.d(t,{n:()=>o});var i=a(2099),r=a(9509);class n{async sendInvitationEmail(e){let t="Co-parenting invitation from ".concat(e.inviter_name),a=this.generateInvitationEmailContent(e);console.log("--- EMAIL WOULD BE SENT ---"),console.log("To: ".concat(e.invitee_email)),console.log("From: ".concat(e.inviter_email)),console.log("Subject: ".concat(t)),console.log("Content:\n".concat(a)),console.log("--- END EMAIL ---")}async sendEmail(e,t,a){console.log("--- EMAIL WOULD BE SENT ---"),console.log("To: ".concat(e)),console.log("Subject: ".concat(t)),console.log("Content:\n".concat(a)),console.log("--- END EMAIL ---")}generateInvitationEmailContent(e){let t="".concat(r.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000","/invite?code=").concat(e.invitation_code);return"\nHi there!\n\n".concat(e.inviter_name," (").concat(e.inviter_email,") has invited you to join CoParent.Online to co-parent ").concat(e.child_name,".\n\nBenefits of joining CoParent.Online:\n• Share schedules and coordinate custody seamlessly\n• Track shared expenses and manage finances together  \n• Manage your child's inventory and belongings\n• Communicate effectively through our platform\n• Access mediation tools for resolving conflicts\n\n").concat(e.message?"Personal message from ".concat(e.inviter_name,':\n"').concat(e.message,'"\n\n'):"","\n\nTo accept this invitation, click the link below:\n").concat(t,"\n\nThis invitation will expire on ").concat(new Date(e.expires_at).toLocaleDateString(),".\n\nIf you already have an account, simply log in and the invitation will be processed automatically.\n\nIf you don't have an account yet, you'll be guided through a quick signup process.\n\nBest regards,\nThe CoParent.Online Team\n\n---\nIf you did not expect this invitation or believe this was sent in error, you can safely ignore this email.\n    ").trim()}}class s{async sendInvitation(e){let{data:{user:t},error:a}=await this.supabase.auth.getUser();if(a||!t)throw Error("User not authenticated");let{data:i,error:r}=await this.supabase.from("users").select("full_name, email").eq("id",t.id).single();if(r||!i)throw Error("Failed to get user information");let{data:n,error:s}=await this.supabase.from("children").select("name").eq("id",e.child_id).single();if(s||!n)throw Error("Failed to get child information");let{data:o}=await this.supabase.from("co_parent_invitations").select("id, status").eq("inviter_id",t.id).eq("invitee_email",e.invitee_email).eq("child_id",e.child_id).eq("status","pending").single();if(o)throw Error("An invitation is already pending for this email and child");let{data:l,error:d}=await this.supabase.from("co_parent_invitations").insert({inviter_id:t.id,invitee_email:e.invitee_email,child_id:e.child_id}).select().single();if(d||!l)throw Error("Failed to create invitation");let c={inviter_name:i.full_name,inviter_email:i.email,invitee_email:e.invitee_email,child_name:n.name,invitation_code:l.invitation_code,expires_at:l.expires_at,message:e.message};try{await this.sendInvitationEmail(c)}catch(e){console.error("Failed to send invitation email:",e)}return l}async sendBulkInvitation(e){let{data:{user:t},error:a}=await this.supabase.auth.getUser();if(a||!t)throw Error("User not authenticated");let{data:i,error:r}=await this.supabase.from("users").select("full_name, email").eq("id",t.id).single();if(r||!i)throw Error("Failed to get user information");let{data:n,error:s}=await this.supabase.from("children").select("id, name").in("id",e.child_ids);if(s||!n)throw Error("Failed to get children information");let{data:o}=await this.supabase.from("co_parent_invitations").select("child_id").eq("inviter_id",t.id).eq("invitee_email",e.invitee_email).in("child_id",e.child_ids).eq("status","pending");if(o&&o.length>0){let e=o.map(e=>e.child_id),t=n.filter(t=>e.includes(t.id)).map(e=>e.name);throw Error("Invitations are already pending for: ".concat(t.join(", ")))}let l=e.child_ids.map(a=>({inviter_id:t.id,invitee_email:e.invitee_email,child_id:a})),{data:d,error:c}=await this.supabase.from("co_parent_invitations").insert(l).select();if(c||!d)throw Error("Failed to create invitations");let u=n.map(e=>e.name),m={inviter_name:i.full_name,inviter_email:i.email,invitee_email:e.invitee_email,child_name:1===u.length?u[0]:u.join(", "),invitation_code:d[0].invitation_code,expires_at:d[0].expires_at,message:e.message};try{await this.sendInvitationEmail(m)}catch(e){console.error("Failed to send invitation email:",e)}return d}async getInvitations(e){let{data:t,error:a}=await this.supabase.from("co_parent_invitations").select("\n        *,\n        children(name),\n        users!inviter_id(full_name, email)\n      ").eq("inviter_id",e).order("created_at",{ascending:!1});if(a)throw Error("Failed to fetch invitations");return t||[]}async getReceivedInvitations(e){let{data:t,error:a}=await this.supabase.from("co_parent_invitations").select("\n        *,\n        children(name),\n        users!inviter_id(full_name, email)\n      ").eq("invitee_email",e).eq("status","pending").order("created_at",{ascending:!1});if(a)throw Error("Failed to fetch received invitations");return t||[]}async acceptInvitation(e){let{data:{user:t},error:a}=await this.supabase.auth.getUser();if(a||!t)throw Error("User not authenticated");let{data:i,error:r}=await this.supabase.from("users").select("email").eq("id",t.id).single();if(r||!i)throw Error("Failed to get user information");let{data:n,error:s}=await this.supabase.from("co_parent_invitations").select("*").eq("invitation_code",e).eq("invitee_email",i.email).eq("status","pending").single();if(s||!n)throw Error("Invitation not found or already processed");if(new Date(n.expires_at)<new Date)throw await this.supabase.from("co_parent_invitations").update({status:"expired"}).eq("id",n.id),Error("Invitation has expired");let{error:o}=await this.supabase.from("co_parent_relationships").insert({child_id:n.child_id,parent_a_id:n.inviter_id,parent_b_id:t.id});if(o)throw Error("Failed to create co-parent relationship");let{error:l}=await this.supabase.from("co_parent_invitations").update({status:"accepted",accepted_at:new Date().toISOString()}).eq("id",n.id);if(l)throw Error("Failed to update invitation status")}async rejectInvitation(e){let{data:{user:t},error:a}=await this.supabase.auth.getUser();if(a||!t)throw Error("User not authenticated");let{data:i,error:r}=await this.supabase.from("users").select("email").eq("id",t.id).single();if(r||!i)throw Error("Failed to get user information");let{error:n}=await this.supabase.from("co_parent_invitations").update({status:"rejected"}).eq("invitation_code",e).eq("invitee_email",i.email).eq("status","pending");if(n)throw Error("Failed to reject invitation")}async sendInvitationEmail(e){let t=new n;await t.sendInvitationEmail(e)}constructor(){this.supabase=(0,i.k)()}}let o=new s},9039:(e,t,a)=>{Promise.resolve().then(a.bind(a,9146))},9146:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var i=a(5155),r=a(2115),n=a(5695),s=a(6083),o=a(2099),l=a(6249),d=a(6874),c=a.n(d);function u(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),{signIn:a}=(0,s.A)(),[d,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[g,v]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),x=null==t?void 0:t.get("invitation_code"),b=async t=>{t.preventDefault(),v(!0),f(null);try{if(await a(d,m),x)try{await l.n.acceptInvitation(x),e.push("/dashboard?invitation_accepted=true")}catch(t){console.error("Failed to accept invitation:",t),e.push("/dashboard")}else e.push("/dashboard")}catch(t){console.error("Error during login:",t);let e="An error occurred during login";t instanceof Error&&(e=t.message.includes("fetch")||t.message.includes("network")?"Network error - please check your internet connection and try again":t.message.includes("Invalid login credentials")?"Invalid email or password":t.message),f(e)}finally{v(!1)}},w=async()=>{if(!d)return void f("Please enter your email address to reset your password");v(!0),f(null);try{let e=(0,o.k)(),t="".concat(window.location.origin,"/reset-password"),{error:a}=await e.auth.resetPasswordForEmail(d,{redirectTo:t});if(a)throw a;alert("Password reset email sent. Please check your inbox.")}catch(e){console.error("Error during password reset:",e),f(e instanceof Error?e.message:"An error occurred during password reset")}finally{v(!1)}};return(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white",children:"Sign in to your account"}),(0,i.jsxs)("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:["Or"," ",(0,i.jsx)(c(),{href:"/signup",className:"font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300",children:"create a new account"})]})]}),(0,i.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:b,children:[(0,i.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),(0,i.jsx)("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,"data-testid":"login-email",className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Email address",value:d,onChange:e=>u(e.target.value)})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Password"}),(0,i.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,"data-testid":"login-password",className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Password",value:m,onChange:e=>h(e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600"}),(0,i.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900 dark:text-gray-300",children:"Remember me"})]}),(0,i.jsx)("button",{type:"button",onClick:w,className:"text-sm font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300",children:"Forgot your password?"})]}),p&&(0,i.jsx)("div",{className:"rounded-md bg-red-50 dark:bg-red-900/30 p-4",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,i.jsx)("div",{className:"ml-3",children:(0,i.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:p})})]})}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{type:"submit",disabled:g,"data-testid":"login-submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Signing in...":"Sign in"})})]}),(0,i.jsxs)("div",{className:"mt-6",children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,i.jsx)("div",{className:"w-full border-t border-gray-300 dark:border-gray-700"})}),(0,i.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,i.jsx)("span",{className:"px-2 bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:"Or continue with"})})]}),(0,i.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("a",{href:"#",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700",children:[(0,i.jsx)("span",{className:"sr-only",children:"Sign in with Google"}),(0,i.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,i.jsx)("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})})]})}),(0,i.jsx)("div",{children:(0,i.jsxs)("a",{href:"#",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700",children:[(0,i.jsx)("span",{className:"sr-only",children:"Sign in with Facebook"}),(0,i.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z",clipRule:"evenodd"})})]})})]})]})]})})}function m(){return(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)("div",{children:"Loading..."}),children:(0,i.jsx)(u,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[982,874,83,441,684,358],()=>t(9039)),_N_E=e.O()}]);