(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[259],{469:(e,s,r)=>{"use strict";r.d(s,{m:()=>o});var t=r(5155),a=r(2115),n=r(4110),i=r(2099);let l=["7:00","8:00","9:00","12:00","15:00","16:00","17:00","18:00","19:00","20:00"],d=["8:00","9:00","10:00","11:00","12:00","14:00","16:00","17:00","18:00","19:00","20:00"],c={"7:00":"Early morning","8:00":"Before school/work","9:00":"Morning","12:00":"Lunch time","15:00":"After school","16:00":"Late afternoon","17:00":"Before dinner","18:00":"Dinner time","19:00":"After dinner","20:00":"Evening","21:00":"Late evening"};function o(e){let{relationshipId:s,currentUserId:r,dayType:o,existingPreferences:m=[],timeSlots:h,onPreferencesUpdated:u}=e,[x,f]=(0,a.useState)(!1),[p,y]=(0,a.useState)(null),[g,b]=(0,a.useState)(!1),[j,N]=(0,a.useState)([]),v=(0,i.k)(),w=h||("weekday"===o?l:d);(0,a.useEffect)(()=>{N(m.filter(e=>e.dayType===o).map(e=>e.time))},[m,o]);let S=e=>{let[s,r]=e.split(":"),t=parseInt(s);return"".concat(0===t?12:t>12?t-12:t,":").concat(r," ").concat(t>=12?"PM":"AM")},k=e=>c[e]||"",P=(e,s)=>{s?N(s=>[...s,e]):N(s=>s.filter(s=>s!==e))},_=async e=>{f(!0),y(null);try{let t=e.map((e,t)=>({relationshipId:s,userId:r,time:e.id,dayType:o,priority:t+1,context:k(e.id)}));await v.from("handoff_time_preferences").delete().eq("relationshipId",s).eq("userId",r).eq("dayType",o);let{error:a}=await v.from("handoff_time_preferences").insert(t);if(a)throw a;if(u){let e=t.map((e,s)=>({...e,id:"temp-".concat(s),createdAt:new Date,updatedAt:new Date}));u(e)}b(!1)}catch(e){y("Error saving handoff time preferences. Please try again."),console.error("Error saving handoff time preferences:",e)}finally{f(!1)}};if(g){let e=(()=>{let e=m.filter(e=>e.dayType===o).reduce((e,s)=>(e[s.time]=s,e),{});return j.sort((s,r)=>{let t=e[s],a=e[r];return t&&a?t.priority-a.priority:t?-1:a?1:s.localeCompare(r)}).map(e=>({id:e,label:S(e),description:k(e),metadata:{time:e,dayType:o}}))})();return(0,t.jsxs)("div",{className:"space-y-4",children:[x&&(0,t.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,t.jsx)("p",{className:"text-blue-800",children:"Saving your preferences..."})}),p&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,t.jsx)("p",{className:"text-red-800",children:p})}),(0,t.jsx)("button",{onClick:()=>{b(!1),y(null)},className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center",disabled:x,children:"← Back to Time Selection"}),(0,t.jsx)(n.S,{items:e,onSortComplete:_,title:"Sort Your ".concat("weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"),description:"Choose which handoff time you prefer when given the option. Your most preferred time will be ranked first."})]})}return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"]}),(0,t.jsx)("p",{className:"text-gray-600",children:"Select your preferred handoff times and sort them by preference to help with custody scheduling."})]}),p&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,t.jsx)("p",{className:"text-red-800",children:p})}),(0,t.jsxs)("div",{"data-testid":"time-selector",className:"space-y-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Select Preferred Handoff Times"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:w.map(e=>(0,t.jsxs)("label",{className:"\n                flex items-center space-x-2 p-3 rounded-lg border cursor-pointer transition-colors\n                ".concat(j.includes(e)?"bg-blue-50 border-blue-300 text-blue-900":"bg-white border-gray-200 hover:bg-gray-50","\n              "),children:[(0,t.jsx)("input",{type:"checkbox",checked:j.includes(e),onChange:s=>P(e,s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","data-testid":"time-".concat(e)}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-medium",children:S(e)}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:k(e)})]})]},e))}),(0,t.jsxs)("div",{"data-testid":"selected-times",className:"mt-4",children:[(0,t.jsxs)("h3",{className:"text-md font-medium mb-2",children:["Selected Times (",j.length,")"]}),j.length>0?(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(e=>(0,t.jsxs)("span",{"data-testid":"selected-".concat(e),className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[S(e),(0,t.jsx)("button",{onClick:()=>P(e,!1),className:"ml-2 text-blue-600 hover:text-blue-800","aria-label":"Remove ".concat(S(e)),children:"\xd7"})]},e))}):(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No times selected"})]}),(0,t.jsx)("button",{onClick:()=>{if(j.length<2)return void y("Please select at least 2 handoff times to sort.");b(!0),y(null)},disabled:j.length<2||x,"data-testid":"start-sorting",className:"\n            w-full py-3 px-4 rounded-md font-medium transition-colors\n            ".concat(j.length>=2&&!x?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n          "),children:x?"Saving...":"Start Sorting Preferences"}),j.length<2&&(0,t.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Select at least 2 handoff times to enable sorting"})]})]})}},3518:(e,s,r)=>{"use strict";r.d(s,{o:()=>d});var t=r(5155),a=r(2115),n=r(6083),i=r(5695),l=r(2099);function d(e){let{children:s,redirectTo:r="/setup"}=e,{user:d,isLoading:c,isAuthenticated:o}=(0,n.A)(),m=(0,i.useRouter)(),[h,u]=(0,a.useState)(!0),[x,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{!c&&o&&d&&p()},[c,o,d]);let p=async()=>{if(d)try{let s=(0,l.k)(),{data:t,error:a}=await s.from("co_parent_relationships").select("id").or("parent_a_id.eq.".concat(d.id,",parent_b_id.eq.").concat(d.id)).limit(1);if(a){var e;if(console.error("Error checking co-parent relationships:",a),"42501"===a.code||(null==(e=a.message)?void 0:e.includes("permission denied"))){f(!1),u(!1),m.push(r);return}}let n=t&&t.length>0;f(n),n||m.push(r)}catch(e){console.error("Error checking user setup:",e),m.push(r)}finally{u(!1)}};return c||h?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{children:"Loading..."})]})}):o&&x?(0,t.jsx)(t.Fragment,{children:s}):null}},3538:(e,s,r)=>{Promise.resolve().then(r.bind(r,6933))},5034:(e,s,r)=>{"use strict";r.d(s,{DayPreferenceSorting:()=>d});var t=r(5155),a=r(2115),n=r(4110),i=r(7926);let l=[{id:"0",label:"Sunday",description:"Weekend day"},{id:"1",label:"Monday",description:"Start of school week"},{id:"2",label:"Tuesday",description:"School day"},{id:"3",label:"Wednesday",description:"Mid-week"},{id:"4",label:"Thursday",description:"School day"},{id:"5",label:"Friday",description:"End of school week"},{id:"6",label:"Saturday",description:"Weekend day"}];function d(e){let{relationshipId:s,currentUserId:r,existingPreferences:d=[],otherParentPreferences:c=[],onPreferencesUpdated:o}=e,[m,h]=(0,a.useState)(l),[u,x]=(0,a.useState)(!1),[f,p]=(0,a.useState)(null),[y,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(d.length>0){let e=[...d].sort((e,s)=>e.priority-s.priority),s=e.map(e=>l.find(s=>parseInt(s.id)===e.dayOfWeek)),r=new Set(e.map(e=>e.dayOfWeek.toString()));h([...s,...l.filter(e=>!r.has(e.id))])}},[d]);let b=async e=>{x(!0),p(null);try{let t=e.map((e,s)=>({dayOfWeek:parseInt(e.id),priority:s+1}));await i.t.saveDayPreferences(r,s,t),h(e),o&&o()}catch(e){p("Error saving preferences. Please try again."),console.error("Error saving day preferences:",e)}finally{x(!1)}};return(0,t.jsxs)("div",{className:"space-y-6","data-testid":"day-preferences",children:[c.length>0&&(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Other Parent's Preferences"}),(0,t.jsx)("button",{onClick:()=>g(!y),className:"text-blue-600 hover:text-blue-800 text-sm",children:y?"Hide":"Show"})]}),y&&(0,t.jsx)("div",{className:"space-y-2",children:c.sort((e,s)=>e.priority-s.priority).map((e,s)=>{let r=l.find(s=>parseInt(s.id)===e.dayOfWeek);return(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsx)("span",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs mr-3",children:s+1}),(0,t.jsx)("span",{children:null==r?void 0:r.label})]},e.dayOfWeek)})})]}),f&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-red-800",children:f})}),u&&(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("p",{className:"text-gray-600",children:"Saving your preferences..."})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("button",{"data-testid":"sort-day-preferences",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>{let e=document.querySelector('[data-testid="sorting-component"]');e&&e.scrollIntoView({behavior:"smooth"})},children:"Start Sorting Day Preferences"})}),(0,t.jsx)(n.S,{items:m,onSortComplete:b,title:"Sort Your Day Preferences",description:"Rank the days of the week by your preference to have your child. Most preferred days will be ranked higher."})]})}},5695:(e,s,r)=>{"use strict";var t=r(8999);r.o(t,"usePathname")&&r.d(s,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(s,{useSearchParams:function(){return t.useSearchParams}})},6933:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>m});var t=r(5155),a=r(2115),n=r(5034),i=r(387),l=r(469),d=r(2099),c=r(7926),o=r(3518);function m(){var e;let{user:s,currentRelationship:r,loading:m,error:h}=function(){let[e,s]=(0,a.useState)(null),[r,t]=(0,a.useState)([]),[n,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),[o,m]=(0,a.useState)(null),h=(0,d.k)();(0,a.useEffect)(()=>{u()},[]);let u=async()=>{try{c(!0),m(null);let{data:{user:e},error:r}=await h.auth.getUser();if(r)throw r;if(!e){s(null),t([]),i(null);return}let{data:a,error:l}=await h.from("users").select("*").eq("id",e.id).single();if(l)throw l;s(a);let{data:d,error:o}=await h.from("co_parent_relationships").select("\n          *,\n          child:children(*)\n        ").or("parent_a_id.eq.".concat(e.id,",parent_b_id.eq.").concat(e.id));if(o)throw o;t(d||[]),d&&d.length>0&&!n&&i(d[0])}catch(s){console.error("useAuthData: Error fetching user data:",s);let e="Failed to fetch user data";s.message.includes("Failed to fetch")||s.message.includes("Network")?e="Network error. Please check your internet connection and try again.":s.message.includes("Auth session missing")&&(e="Authentication session expired. Please sign in again."),m(e)}finally{c(!1)}};return{user:e,relationships:r,currentRelationship:n,loading:l,error:o,setCurrentRelationshipId:e=>{let s=r.find(s=>s.id===e);s&&i(s)}}}(),[u,x]=(0,a.useState)(null),[f,p]=(0,a.useState)(null),[y,g]=(0,a.useState)(!0),[b,j]=(0,a.useState)(null);(0,a.useEffect)(()=>{s&&r?N():m||g(!1)},[s,r,m]);let N=async()=>{if(s&&r)try{g(!0),j(null);let e=await c.t.getUserPreferences(s.id,r.id);x(e);let t=r.parent_a_id===s.id?r.parent_b_id:r.parent_a_id,a=await c.t.getUserPreferences(t,r.id);p(a)}catch(e){console.error("PreferencesPage: Error loading preferences:",e),j(e.message||"Failed to load preferences")}finally{g(!1)}},v=()=>{N()};return m||y?(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-8"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})]})})}):h||b?(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-red-800 font-semibold mb-2",children:"Error Loading Preferences"}),(0,t.jsx)("p",{className:"text-red-600",children:h||b}),(0,t.jsx)("button",{onClick:N,className:"mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Try Again"})]})})}):s&&r?(0,t.jsx)(o.o,{children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Preferences"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Set your preferences for scheduling and co-parenting arrangements. These preferences will be saved and applied when creating or suggesting schedules."}),r&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Current relationship: Child - ",(null==(e=r.child)?void 0:e.name)||"Unknown"]})]}),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("section",{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Day Preferences"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Rank the days of the week by your preference to have your child. Most preferred days will be prioritized in scheduling suggestions."}),(0,t.jsx)(n.DayPreferenceSorting,{relationshipId:r.id,currentUserId:s.id,existingPreferences:(null==u?void 0:u.dayPreferences)||[],otherParentPreferences:(null==f?void 0:f.dayPreferences)||[],onPreferencesUpdated:v})]}),(0,t.jsxs)("section",{"data-testid":"date-preferences",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Date Preferences"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Select and rank specific dates that are important to you (holidays, birthdays, special events)."}),(0,t.jsx)(i.Q,{relationshipId:r.id,currentUserId:s.id,selectedDates:[],existingPreferences:(null==u?void 0:u.datePreferences)||[],onPreferencesUpdated:v})]}),(0,t.jsxs)("section",{"data-testid":"handoff-time-preferences",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Handoff Time Preferences"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Set your preferred times for child handoffs. Different times can be set for weekdays and weekends."}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Weekday Handoff Times"}),(0,t.jsx)(l.m,{relationshipId:r.id,currentUserId:s.id,dayType:"weekday",existingPreferences:[],onPreferencesUpdated:v})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-3",children:"Weekend Handoff Times"}),(0,t.jsx)(l.m,{relationshipId:r.id,currentUserId:s.id,dayType:"weekend",existingPreferences:[],onPreferencesUpdated:v})]})]})]}),u&&(0,t.jsxs)("section",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4 text-blue-800",children:"Your Preference Summary"}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-blue-700 mb-2",children:"Day Preferences"}),u.dayPreferences.length>0?(0,t.jsx)("ul",{className:"space-y-1",children:u.dayPreferences.sort((e,s)=>e.priority-s.priority).slice(0,3).map((e,s)=>(0,t.jsxs)("li",{className:"text-blue-600",children:[s+1,". ",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.day_of_week]]},e.id))}):(0,t.jsx)("p",{className:"text-gray-500 italic",children:"No preferences set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-blue-700 mb-2",children:"Date Preferences"}),u.datePreferences.length>0?(0,t.jsx)("ul",{className:"space-y-1",children:u.datePreferences.sort((e,s)=>e.priority-s.priority).slice(0,3).map((e,s)=>(0,t.jsxs)("li",{className:"text-blue-600",children:[s+1,". ",new Date(e.date).toLocaleDateString()]},e.id))}):(0,t.jsx)("p",{className:"text-gray-500 italic",children:"No preferences set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-blue-700 mb-2",children:"Handoff Times"}),u.handoffTimes.length>0?(0,t.jsx)("ul",{className:"space-y-1",children:u.handoffTimes.slice(0,3).map((e,s)=>(0,t.jsx)("li",{className:"text-blue-600",children:e.time},e.id))}):(0,t.jsx)("p",{className:"text-gray-500 italic",children:"No preferences set"})]})]})]})]})]})})}):(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-yellow-800 font-semibold mb-2",children:"Authentication Required"}),(0,t.jsx)("p",{className:"text-yellow-600",children:"Please log in and ensure you have a co-parent relationship set up to manage preferences."})]})})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[277,982,804,83,796,110,387,441,684,358],()=>s(3538)),_N_E=e.O()}]);