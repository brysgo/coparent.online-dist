(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[883],{844:(e,r,t)=>{"use strict";t.d(r,{GY:()=>c,h9:()=>n,hV:()=>o});var a=t(9509);function s(){let e=i();return"main"===e||"master"===e||"production"===e?"production":"development"}function i(){return"copilot/fix-82"}function n(){if("production"===s())return{url:"https://placeholder.supabase.co",anonKey:"placeholder-anon-key",serviceRoleKey:a.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};{let e=a.env.SUPABASE_DEV_URL||"https://bqiapoplmkkrtnsmmxhs.supabase.co";return{url:e,anonKey:a.env.SUPABASE_DEV_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDA3OTMsImV4cCI6MjA2ODAxNjc5M30.bZGNGvb8XYZSWkbfMYMNBAzoedp4SGOIerHmNcRqUsk",serviceRoleKey:a.env.SUPABASE_DEV_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjQ0MDc5MywiZXhwIjoyMDY4MDE2NzkzfQ.7m9y2vqrq1Sd8bX6dl6A47WQbZoQHGKc7o2rzrcTjKI"}}}function o(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&e.url.includes("supabase.co")}function c(){let e=i(),r=s(),t=n(),a=o(t);return{currentBranch:e,environment:r,supabaseUrl:t.url,hasValidConfig:a,configSource:"production"===r?"production":"development-default"}}},2099:(e,r,t)=>{"use strict";t.d(r,{H:()=>o,k:()=>n});var a=t(4982),s=t(844);let i=null,n=()=>{if(i)return i;let e=(0,s.h9)();return i=(0,s.hV)(e)?(0,a.UU)(e.url,e.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}}):(0,a.UU)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}})},o=()=>{let e=(0,s.h9)();return(0,s.hV)(e)&&e.serviceRoleKey&&"placeholder-service-role-key"!==e.serviceRoleKey?(0,a.UU)(e.url,e.serviceRoleKey,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,a.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}})}},4906:(e,r,t)=>{Promise.resolve().then(t.bind(t,5034))},5034:(e,r,t)=>{"use strict";t.d(r,{DayPreferenceSorting:()=>c});var a=t(5155),s=t(2115),i=t(4110),n=t(7926);let o=[{id:"0",label:"Sunday",description:"Weekend day"},{id:"1",label:"Monday",description:"Start of school week"},{id:"2",label:"Tuesday",description:"School day"},{id:"3",label:"Wednesday",description:"Mid-week"},{id:"4",label:"Thursday",description:"School day"},{id:"5",label:"Friday",description:"End of school week"},{id:"6",label:"Saturday",description:"Weekend day"}];function c(e){let{relationshipId:r,currentUserId:t,existingPreferences:c=[],otherParentPreferences:l=[],onPreferencesUpdated:d}=e,[p,f]=(0,s.useState)(o),[h,u]=(0,s.useState)(!1),[y,m]=(0,s.useState)(null),[_,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(c.length>0){let e=[...c].sort((e,r)=>e.priority-r.priority),r=e.map(e=>o.find(r=>parseInt(r.id)===e.dayOfWeek)),t=new Set(e.map(e=>e.dayOfWeek.toString()));f([...r,...o.filter(e=>!t.has(e.id))])}},[c]);let w=async e=>{u(!0),m(null);try{let a=e.map((e,r)=>({dayOfWeek:parseInt(e.id),priority:r+1}));await n.t.saveDayPreferences(t,r,a),f(e),d&&d()}catch(e){m("Error saving preferences. Please try again."),console.error("Error saving day preferences:",e)}finally{u(!1)}};return(0,a.jsxs)("div",{className:"space-y-6","data-testid":"day-preferences",children:[l.length>0&&(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Other Parent's Preferences"}),(0,a.jsx)("button",{onClick:()=>b(!_),className:"text-blue-600 hover:text-blue-800 text-sm",children:_?"Hide":"Show"})]}),_&&(0,a.jsx)("div",{className:"space-y-2",children:l.sort((e,r)=>e.priority-r.priority).map((e,r)=>{let t=o.find(r=>parseInt(r.id)===e.dayOfWeek);return(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)("span",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs mr-3",children:r+1}),(0,a.jsx)("span",{children:null==t?void 0:t.label})]},e.dayOfWeek)})})]}),y&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-800",children:y})}),h&&(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Saving your preferences..."})}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{"data-testid":"sort-day-preferences",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>{let e=document.querySelector('[data-testid="sorting-component"]');e&&e.scrollIntoView({behavior:"smooth"})},children:"Start Sorting Day Preferences"})}),(0,a.jsx)(i.S,{items:p,onSortComplete:w,title:"Sort Your Day Preferences",description:"Rank the days of the week by your preference to have your child. Most preferred days will be ranked higher."})]})}},7926:(e,r,t)=>{"use strict";t.d(r,{t:()=>i});var a=t(2099);class s{async getUserPreferences(e,r){try{let{data:t,error:a}=await this.supabase.from("day_preferences").select("*").eq("parent_id",e).eq("relationship_id",r).order("priority",{ascending:!0});if(a)throw a;let{data:s,error:i}=await this.supabase.from("date_preferences").select("*").eq("parent_id",e).eq("relationship_id",r).order("priority",{ascending:!0});if(i)throw i;let{data:n,error:o}=await this.supabase.from("handoff_times").select("*").eq("relationship_id",r).order("time",{ascending:!0});if(o)throw o;return{dayPreferences:t||[],datePreferences:s||[],handoffTimes:n||[]}}catch(e){throw console.error("Error fetching user preferences:",e),Error("Failed to fetch user preferences")}}async saveDayPreferences(e,r,t){try{let{error:a}=await this.supabase.from("day_preferences").delete().eq("parent_id",e).eq("relationship_id",r);if(a)throw a;let s=t.map(t=>({relationship_id:r,parent_id:e,day_of_week:t.dayOfWeek,priority:t.priority})),{data:i,error:n}=await this.supabase.from("day_preferences").insert(s).select();if(n)throw n;return i||[]}catch(e){throw console.error("Error saving day preferences:",e),Error("Failed to save day preferences")}}async saveDatePreferences(e,r,t){try{let{error:a}=await this.supabase.from("date_preferences").delete().eq("parent_id",e).eq("relationship_id",r);if(a)throw a;let s=t.map(t=>({relationship_id:r,parent_id:e,date:t.date,priority:t.priority})),{data:i,error:n}=await this.supabase.from("date_preferences").insert(s).select();if(n)throw n;return i||[]}catch(e){throw console.error("Error saving date preferences:",e),Error("Failed to save date preferences")}}async saveHandoffTimePreferences(e,r){try{let{error:t}=await this.supabase.from("handoff_times").delete().eq("relationship_id",e);if(t)throw t;let a=r.map(r=>({relationship_id:e,time:r.time,priority_parent_a:r.priorityParentA,priority_parent_b:r.priorityParentB})),{data:s,error:i}=await this.supabase.from("handoff_times").insert(a).select();if(i)throw i;return s||[]}catch(e){throw console.error("Error saving handoff time preferences:",e),Error("Failed to save handoff time preferences")}}async getRelationshipPreferenceSummary(e){try{let{data:r,error:t}=await this.supabase.from("co_parent_relationships").select("parent_a_id, parent_b_id").eq("id",e).single();if(t)throw t;let a=await this.getUserPreferenceSummary(r.parent_a_id,e),s=await this.getUserPreferenceSummary(r.parent_b_id,e);return{parentA:a,parentB:s}}catch(e){return console.error("Error fetching relationship preference summary:",e),{parentA:null,parentB:null}}}async getUserPreferenceSummary(e,r){try{let t=await this.getUserPreferences(e,r),a=t.dayPreferences.sort((e,r)=>e.priority-r.priority).map(e=>e.day_of_week),s=t.handoffTimes.map(t=>({time:t.time,priority:e===r?t.priority_parent_a:t.priority_parent_b})).sort((e,r)=>e.priority-r.priority).map(e=>e.time),i=t.datePreferences.sort((e,r)=>e.priority-r.priority).map(e=>e.date),n=[...t.dayPreferences.map(e=>e.updated_at),...t.datePreferences.map(e=>e.updated_at),...t.handoffTimes.map(e=>e.updated_at)],o=n.length>0?n.sort().reverse()[0]:new Date().toISOString();return{userId:e,relationshipId:r,preferredDays:a,preferredTimes:s,importantDates:i,lastUpdated:o}}catch(e){return console.error("Error getting user preference summary:",e),null}}async hasPreferences(e,r){try{let t=await this.getUserPreferences(e,r);return t.dayPreferences.length>0||t.datePreferences.length>0||t.handoffTimes.length>0}catch(e){return console.error("Error checking if preferences exist:",e),!1}}async getPreferenceConflicts(e){try{let r=await this.getRelationshipPreferenceSummary(e);if(!r.parentA||!r.parentB)return{dayConflicts:[],timeConflicts:[],dateConflicts:[]};let t=[];for(let e=0;e<=6;e++){let a=r.parentA.preferredDays.indexOf(e),s=r.parentB.preferredDays.indexOf(e);-1!==a&&-1!==s&&a<3&&s<3&&t.push({day:e,parentAPrefs:a+1,parentBPrefs:s+1})}let a=[];for(let e of r.parentA.preferredTimes.filter(e=>r.parentB.preferredTimes.includes(e))){let t=r.parentA.preferredTimes.indexOf(e),s=r.parentB.preferredTimes.indexOf(e);a.push({time:e,parentAPrefs:t+1,parentBPrefs:s+1})}let s=[];for(let e of r.parentA.importantDates.filter(e=>r.parentB.importantDates.includes(e)))s.push({date:e,bothWant:!0});return{dayConflicts:t,timeConflicts:a,dateConflicts:s}}catch(e){return console.error("Error analyzing preference conflicts:",e),{dayConflicts:[],timeConflicts:[],dateConflicts:[]}}}constructor(e=!1){e?this.supabase=null:this.supabase=(0,a.k)()}}let i=new s}},e=>{var r=r=>e(e.s=r);e.O(0,[277,982,804,796,110,441,684,358],()=>r(4906)),_N_E=e.O()}]);