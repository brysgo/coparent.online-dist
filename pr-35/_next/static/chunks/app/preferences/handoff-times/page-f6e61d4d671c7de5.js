(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[581],{2099:(e,t,s)=>{"use strict";s.d(t,{H:()=>l,k:()=>a});var r=s(4982),n=s(7358);let a=()=>{let e="https://gjgldkinpnckfwzwdbmt.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqZ2xka2lucG5ja2Z3endkYm10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0OTczMDYsImV4cCI6MjA2NzA3MzMwNn0.5ZQourcUdjk19MWjLQ9O0VhcHJj09YPzcxbN35MfMtQ";return e&&t?(0,r.UU)(e,t):(console.warn("Supabase environment variables not found, using fallback values for static generation"),(0,r.UU)("https://placeholder.supabase.co","placeholder-anon-key"))},l=()=>{let e="https://gjgldkinpnckfwzwdbmt.supabase.co",t=n.env.SUPABASE_SERVICE_ROLE_KEY;return e&&t?(0,r.UU)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}}):(console.warn("Supabase service role environment variables not found, using fallback values for static generation"),(0,r.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}}))}},4778:(e,t,s)=>{Promise.resolve().then(s.bind(s,6739))},6739:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(5155),n=s(2115),a=s(4110),l=s(2099);let d=["7:00","8:00","9:00","12:00","15:00","16:00","17:00","18:00","19:00","20:00"],i=["8:00","9:00","10:00","11:00","12:00","14:00","16:00","17:00","18:00","19:00","20:00"],c={"7:00":"Early morning","8:00":"Before school/work","9:00":"Morning","12:00":"Lunch time","15:00":"After school","16:00":"Late afternoon","17:00":"Before dinner","18:00":"Dinner time","19:00":"After dinner","20:00":"Evening","21:00":"Late evening"};function o(e){let{relationshipId:t,currentUserId:s,dayType:o,existingPreferences:m=[],timeSlots:u,onPreferencesUpdated:h}=e,[x,f]=(0,n.useState)(!1),[p,b]=(0,n.useState)(null),[g,y]=(0,n.useState)(!1),[j,k]=(0,n.useState)([]),N=(0,l.k)(),w=u||("weekday"===o?d:i);(0,n.useEffect)(()=>{k(m.filter(e=>e.dayType===o).map(e=>e.time))},[m,o]);let v=e=>{let[t,s]=e.split(":"),r=parseInt(t);return"".concat(0===r?12:r>12?r-12:r,":").concat(s," ").concat(r>=12?"PM":"AM")},S=e=>c[e]||"",I=(e,t)=>{t?k(t=>[...t,e]):k(t=>t.filter(t=>t!==e))},C=async e=>{f(!0),b(null);try{let r=e.map((e,r)=>({relationshipId:t,userId:s,time:e.id,dayType:o,priority:r+1,context:S(e.id)}));await N.from("handoff_time_preferences").delete().eq("relationshipId",t).eq("userId",s).eq("dayType",o);let{error:n}=await N.from("handoff_time_preferences").insert(r);if(n)throw n;if(h){let e=r.map((e,t)=>({...e,id:"temp-".concat(t),createdAt:new Date,updatedAt:new Date}));h(e)}y(!1)}catch(e){b("Error saving handoff time preferences. Please try again."),console.error("Error saving handoff time preferences:",e)}finally{f(!1)}};if(g){let e=(()=>{let e=m.filter(e=>e.dayType===o).reduce((e,t)=>(e[t.time]=t,e),{});return j.sort((t,s)=>{let r=e[t],n=e[s];return r&&n?r.priority-n.priority:r?-1:n?1:t.localeCompare(s)}).map(e=>({id:e,label:v(e),description:S(e),metadata:{time:e,dayType:o}}))})();return(0,r.jsxs)("div",{className:"space-y-4",children:[x&&(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,r.jsx)("p",{className:"text-blue-800",children:"Saving your preferences..."})}),p&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsx)("p",{className:"text-red-800",children:p})}),(0,r.jsx)("button",{onClick:()=>{y(!1),b(null)},className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center",disabled:x,children:"← Back to Time Selection"}),(0,r.jsx)(a.S,{items:e,onSortComplete:C,title:"Sort Your ".concat("weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"),description:"Choose which handoff time you prefer when given the option. Your most preferred time will be ranked first."})]})}return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"]}),(0,r.jsx)("p",{className:"text-gray-600",children:"Select your preferred handoff times and sort them by preference to help with custody scheduling."})]}),p&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsx)("p",{className:"text-red-800",children:p})}),(0,r.jsxs)("div",{"data-testid":"time-selector",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Select Preferred Handoff Times"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:w.map(e=>(0,r.jsxs)("label",{className:"\n                flex items-center space-x-2 p-3 rounded-lg border cursor-pointer transition-colors\n                ".concat(j.includes(e)?"bg-blue-50 border-blue-300 text-blue-900":"bg-white border-gray-200 hover:bg-gray-50","\n              "),children:[(0,r.jsx)("input",{type:"checkbox",checked:j.includes(e),onChange:t=>I(e,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","data-testid":"time-".concat(e)}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-medium",children:v(e)}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:S(e)})]})]},e))}),(0,r.jsxs)("div",{"data-testid":"selected-times",className:"mt-4",children:[(0,r.jsxs)("h3",{className:"text-md font-medium mb-2",children:["Selected Times (",j.length,")"]}),j.length>0?(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(e=>(0,r.jsxs)("span",{"data-testid":"selected-".concat(e),className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[v(e),(0,r.jsx)("button",{onClick:()=>I(e,!1),className:"ml-2 text-blue-600 hover:text-blue-800","aria-label":"Remove ".concat(v(e)),children:"\xd7"})]},e))}):(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"No times selected"})]}),(0,r.jsx)("button",{onClick:()=>{if(j.length<2)return void b("Please select at least 2 handoff times to sort.");y(!0),b(null)},disabled:j.length<2||x,"data-testid":"start-sorting",className:"\n            w-full py-3 px-4 rounded-md font-medium transition-colors\n            ".concat(j.length>=2&&!x?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n          "),children:x?"Saving...":"Start Sorting Preferences"}),j.length<2&&(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Select at least 2 handoff times to enable sorting"})]})]})}function m(){let[e,t]=(0,n.useState)("weekday"),[s,a]=(0,n.useState)([]),[d,i]=(0,n.useState)(!0),[c,m]=(0,n.useState)(null),u="demo-relationship-123",h="demo-user-123",x=(0,l.k)();(0,n.useEffect)(()=>{f()},[]);let f=async()=>{try{i(!0);let{data:e,error:t}=await x.from("handoff_time_preferences").select("*").eq("relationshipId",u).eq("userId",h);t?(console.warn("Could not load preferences (demo mode):",t),a([])):a(e||[])}catch(e){console.warn("Could not load preferences (demo mode):",e),a([])}finally{i(!1)}},p=e=>s.filter(t=>t.dayType===e);return d?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading your preferences..."})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Handoff Time Preferences"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Set your preferred handoff times for weekdays and weekends to help with custody scheduling."})]}),c&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:(0,r.jsx)("p",{className:"text-red-800",children:c})}),(0,r.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg mb-8",children:[(0,r.jsxs)("button",{onClick:()=>t("weekday"),className:"\n                flex-1 py-2 px-4 rounded-md font-medium transition-colors\n                ".concat("weekday"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900","\n              "),"data-testid":"weekday-tab",children:["Weekdays",p("weekday").length>0&&(0,r.jsx)("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full",children:p("weekday").length})]}),(0,r.jsxs)("button",{onClick:()=>t("weekend"),className:"\n                flex-1 py-2 px-4 rounded-md font-medium transition-colors\n                ".concat("weekend"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900","\n              "),"data-testid":"weekend-tab",children:["Weekends",p("weekend").length>0&&(0,r.jsx)("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full",children:p("weekend").length})]})]}),(0,r.jsx)("div",{"data-testid":"".concat(e,"-content"),children:(0,r.jsx)(o,{relationshipId:u,currentUserId:h,dayType:e,existingPreferences:p(e),onPreferencesUpdated:t=>{a(s=>[...s.filter(t=>t.dayType!==e),...t])}})})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[212,982,796,110,441,684,358],()=>t(4778)),_N_E=e.O()}]);