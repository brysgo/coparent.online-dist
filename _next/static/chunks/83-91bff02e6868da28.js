"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[83],{844:(e,i,t)=>{t.d(i,{GY:()=>o,h9:()=>s,hV:()=>n});var a=t(9509);function r(){let e="main";return"production"}function s(){if("production"===r())return{url:"https://gjgldkinpnckfwzwdbmt.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqZ2xka2lucG5ja2Z3endkYm10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0OTczMDYsImV4cCI6MjA2NzA3MzMwNn0.5ZQourcUdjk19MWjLQ9O0VhcHJj09YPzcxbN35MfMtQ",serviceRoleKey:a.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};{let e=a.env.NEXT_PUBLIC_SUPABASE_DEV_URL||a.env.SUPABASE_DEV_URL||"https://bqiapoplmkkrtnsmmxhs.supabase.co";return{url:e,anonKey:a.env.NEXT_PUBLIC_SUPABASE_DEV_ANON_KEY||a.env.SUPABASE_DEV_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDA3OTMsImV4cCI6MjA2ODAxNjc5M30.bZGNGvb8XYZSWkbfMYMNBAzoedp4SGOIerHmNcRqUsk",serviceRoleKey:a.env.SUPABASE_DEV_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaWFwb3BsbWtrcnRuc21teGhzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjQ0MDc5MywiZXhwIjoyMDY4MDE2NzkzfQ.7m9y2vqrq1Sd8bX6dl6A47WQbZoQHGKc7o2rzrcTjKI"}}}function n(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&(e.url.includes("supabase.co")||e.url.includes("127.0.0.1"))}function o(){let e=r(),i=s(),t=n(i);return{currentBranch:"main",environment:e,supabaseUrl:i.url,hasValidConfig:t,configSource:"production"===e?"production":a.env.NEXT_PUBLIC_SUPABASE_DEV_URL?"development-env-vars":"development-default"}}},2099:(e,i,t)=>{t.d(i,{k:()=>n});var a=t(4982),r=t(844);let s=null,n=()=>{if(s)return s;let e=(0,r.h9)();return s=(0,r.hV)(e)?(0,a.UU)(e.url,e.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}}):(0,a.UU)("https://placeholder.supabase.co","placeholder-anon-key",{auth:{autoRefreshToken:!0,persistSession:!0,storage:window.localStorage,detectSessionInUrl:!0}})}},6083:(e,i,t)=>{t.d(i,{A:()=>l,O:()=>u});var a=t(5155),r=t(2115),s=t(2099),n=t(844);let o=(0,r.createContext)(void 0);function u(e){let{children:i}=e,[t,u]=(0,r.useState)({user:null,isLoading:!0,isAuthenticated:!1}),l=(0,s.k)();(0,r.useEffect)(()=>{if(!l)return;c();let{data:{subscription:e}}=l.auth.onAuthStateChange(async(e,i)=>{"SIGNED_IN"===e&&(null==i?void 0:i.user)?await d(i.user.id):"SIGNED_OUT"===e?u({user:null,isLoading:!1,isAuthenticated:!1}):"TOKEN_REFRESHED"===e&&(null==i||i.user)});return()=>e.unsubscribe()},[]);let c=async()=>{if(l)try{let{data:{session:e},error:i}=await l.auth.getSession();if(i){console.error("Failed to get session:",i),u(e=>({...e,isLoading:!1}));return}(null==e?void 0:e.user)?await d(e.user.id):u(e=>({...e,isLoading:!1}))}catch(e){console.error("Failed to initialize auth:",e),u(e=>({...e,isLoading:!1}))}},d=async e=>{var i,t,a,r;if(l)try{let{data:{session:r}}=await l.auth.getSession();if(!(null==r?void 0:r.user)){console.warn("No valid session found, signing out"),await f();return}let{data:s,error:n}=await l.from("users").select("*").eq("id",e).single();if(n){if(console.error("Failed to load user profile from database:",n),"42P01"===n.code||(null==(i=n.message)?void 0:i.includes("relation"))||(null==(t=n.message)?void 0:t.includes("does not exist"))){console.warn("Database tables missing, creating fallback user profile");let e={id:r.user.id,email:r.user.email||"",full_name:(null==(a=r.user.user_metadata)?void 0:a.full_name)||r.user.email||"User",credit_score:100,created_at:r.user.created_at,updated_at:new Date().toISOString()};u({user:e,isLoading:!1,isAuthenticated:!0});return}throw n}u({user:s,isLoading:!1,isAuthenticated:!0})}catch(i){console.error("Failed to load user profile:",i);let{data:{session:e}}=await l.auth.getSession().catch(()=>({data:{session:null}}));(null==e?void 0:e.user)?(console.warn("Database error but session valid, using fallback user"),u({user:{id:e.user.id,email:e.user.email||"",full_name:(null==(r=e.user.user_metadata)?void 0:r.full_name)||e.user.email||"User",credit_score:100,created_at:e.user.created_at,updated_at:new Date().toISOString()},isLoading:!1,isAuthenticated:!0})):u({user:null,isLoading:!1,isAuthenticated:!1})}},h=async(e,i)=>{if(!l)throw Error("Supabase client not available");try{u(e=>({...e,isLoading:!0}));let t=(0,n.h9)();console.log("Attempting sign in with config:",{url:t.url,hasAnonKey:!!t.anonKey,configSource:(0,n.GY)()});let{data:a,error:r}=await l.auth.signInWithPassword({email:e,password:i});if(r)throw r;if(!a.user)throw Error("No user returned from sign in");await d(a.user.id)}catch(e){throw u(e=>({...e,isLoading:!1})),e}},I=async(e,i,t)=>{if(!l)throw Error("Supabase client not available");try{u(e=>({...e,isLoading:!0}));let{data:a,error:r}=await l.auth.signUp({email:e,password:i,options:{data:{full_name:t}}});if(r)throw r;if(!a.user)throw Error("No user returned from sign up");let{error:s}=await l.from("users").insert({id:a.user.id,email:e,full_name:t,credit_score:100});if(s)throw s;await d(a.user.id)}catch(e){throw u(e=>({...e,isLoading:!1})),e}},f=async()=>{if(l)try{await l.auth.signOut(),u({user:null,isLoading:!1,isAuthenticated:!1})}catch(e){console.error("Failed to sign out:",e)}},w=async()=>{if(l)try{var e;let{data:i,error:t}=await l.auth.refreshSession();if(t)throw t;(null==(e=i.session)?void 0:e.user)&&await d(i.session.user.id)}catch(e){console.error("Failed to refresh session:",e),await f()}},m={...t,signIn:h,signUp:I,signOut:f,refreshSession:w};return(0,a.jsx)(o.Provider,{value:m,children:i})}function l(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);