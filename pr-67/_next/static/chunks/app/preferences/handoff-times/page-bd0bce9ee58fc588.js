(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[581],{2047:(e,t,r)=>{"use strict";r.d(t,{k:()=>d,H:()=>c});var n=r(4982),s=r(9509);function a(){let e=function(){if(void 0!==s&&s.env){if(s.env.GITHUB_HEAD_REF)return s.env.GITHUB_HEAD_REF;if(s.env.GITHUB_REF)return s.env.GITHUB_REF.replace("refs/heads/","");if(s.env.VERCEL_GIT_COMMIT_REF)return s.env.VERCEL_GIT_COMMIT_REF;if(s.env.BRANCH)return s.env.BRANCH}return"main"}();if("main"===e||"master"===e||"production"===e)return{url:"https://placeholder.supabase.co",anonKey:"placeholder-anon-key",serviceRoleKey:s.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"};let t=e.replace(/[^a-zA-Z0-9]/g,"_").toUpperCase(),r=s.env["NEXT_PUBLIC_SUPABASE_URL_".concat(t)]||s.env["SUPABASE_URL_".concat(t)],n=s.env["NEXT_PUBLIC_SUPABASE_ANON_KEY_".concat(t)]||s.env["SUPABASE_ANON_KEY_".concat(t)],a=s.env["SUPABASE_SERVICE_ROLE_KEY_".concat(t)];if(r&&n)return{url:r,anonKey:n,serviceRoleKey:a||"placeholder-service-role-key"};let l="https://gjgldkinpnckfwzwdbmt.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqZ2xka2lucG5ja2Z3endkYm10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0OTczMDYsImV4cCI6MjA2NzA3MzMwNn0.5ZQourcUdjk19MWjLQ9O0VhcHJj09YPzcxbN35MfMtQ",c=s.env.SUPABASE_PREVIEW_SERVICE_ROLE_KEY;return l&&d?{url:l,anonKey:d,serviceRoleKey:c||"placeholder-service-role-key"}:{url:"https://placeholder.supabase.co",anonKey:"placeholder-anon-key",serviceRoleKey:s.env.SUPABASE_SERVICE_ROLE_KEY||"placeholder-service-role-key"}}function l(e){return"https://placeholder.supabase.co"!==e.url&&"placeholder-anon-key"!==e.anonKey&&e.url.includes("supabase.co")}let d=()=>{let e=a();return l(e)?(0,n.UU)(e.url,e.anonKey):(0,n.UU)("https://placeholder.supabase.co","placeholder-anon-key")},c=()=>{let e=a();return l(e)&&e.serviceRoleKey&&"placeholder-service-role-key"!==e.serviceRoleKey?(0,n.UU)(e.url,e.serviceRoleKey,{auth:{autoRefreshToken:!1,persistSession:!1}}):(0,n.UU)("https://placeholder.supabase.co","placeholder-service-role-key",{auth:{autoRefreshToken:!1,persistSession:!1}})}},4778:(e,t,r)=>{Promise.resolve().then(r.bind(r,6739))},6739:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(5155),s=r(2115),a=r(4110),l=r(2047);let d=["7:00","8:00","9:00","12:00","15:00","16:00","17:00","18:00","19:00","20:00"],c=["8:00","9:00","10:00","11:00","12:00","14:00","16:00","17:00","18:00","19:00","20:00"],i={"7:00":"Early morning","8:00":"Before school/work","9:00":"Morning","12:00":"Lunch time","15:00":"After school","16:00":"Late afternoon","17:00":"Before dinner","18:00":"Dinner time","19:00":"After dinner","20:00":"Evening","21:00":"Late evening"};function o(e){let{relationshipId:t,currentUserId:r,dayType:o,existingPreferences:m=[],timeSlots:u,onPreferencesUpdated:h}=e,[p,f]=(0,s.useState)(!1),[x,y]=(0,s.useState)(null),[b,g]=(0,s.useState)(!1),[v,N]=(0,s.useState)([]),j=(0,l.k)(),k=u||("weekday"===o?d:c);(0,s.useEffect)(()=>{N(m.filter(e=>e.dayType===o).map(e=>e.time))},[m,o]);let E=e=>{let[t,r]=e.split(":"),n=parseInt(t);return"".concat(0===n?12:n>12?n-12:n,":").concat(r," ").concat(n>=12?"PM":"AM")},_=e=>i[e]||"",w=(e,t)=>{t?N(t=>[...t,e]):N(t=>t.filter(t=>t!==e))},S=async e=>{f(!0),y(null);try{let n=e.map((e,n)=>({relationshipId:t,userId:r,time:e.id,dayType:o,priority:n+1,context:_(e.id)}));await j.from("handoff_time_preferences").delete().eq("relationshipId",t).eq("userId",r).eq("dayType",o);let{error:s}=await j.from("handoff_time_preferences").insert(n);if(s)throw s;if(h){let e=n.map((e,t)=>({...e,id:"temp-".concat(t),createdAt:new Date,updatedAt:new Date}));h(e)}g(!1)}catch(e){y("Error saving handoff time preferences. Please try again."),console.error("Error saving handoff time preferences:",e)}finally{f(!1)}};if(b){let e=(()=>{let e=m.filter(e=>e.dayType===o).reduce((e,t)=>(e[t.time]=t,e),{});return v.sort((t,r)=>{let n=e[t],s=e[r];return n&&s?n.priority-s.priority:n?-1:s?1:t.localeCompare(r)}).map(e=>({id:e,label:E(e),description:_(e),metadata:{time:e,dayType:o}}))})();return(0,n.jsxs)("div",{className:"space-y-4",children:[p&&(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:(0,n.jsx)("p",{className:"text-blue-800",children:"Saving your preferences..."})}),x&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,n.jsx)("p",{className:"text-red-800",children:x})}),(0,n.jsx)("button",{onClick:()=>{g(!1),y(null)},className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center",disabled:p,children:"← Back to Time Selection"}),(0,n.jsx)(a.S,{items:e,onSortComplete:S,title:"Sort Your ".concat("weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"),description:"Choose which handoff time you prefer when given the option. Your most preferred time will be ranked first."})]})}return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["weekday"===o?"Weekday":"Weekend"," Handoff Time Preferences"]}),(0,n.jsx)("p",{className:"text-gray-600",children:"Select your preferred handoff times and sort them by preference to help with custody scheduling."})]}),x&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,n.jsx)("p",{className:"text-red-800",children:x})}),(0,n.jsxs)("div",{"data-testid":"time-selector",className:"space-y-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Select Preferred Handoff Times"}),(0,n.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:k.map(e=>(0,n.jsxs)("label",{className:"\n                flex items-center space-x-2 p-3 rounded-lg border cursor-pointer transition-colors\n                ".concat(v.includes(e)?"bg-blue-50 border-blue-300 text-blue-900":"bg-white border-gray-200 hover:bg-gray-50","\n              "),children:[(0,n.jsx)("input",{type:"checkbox",checked:v.includes(e),onChange:t=>w(e,t.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","data-testid":"time-".concat(e)}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{className:"font-medium",children:E(e)}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:_(e)})]})]},e))}),(0,n.jsxs)("div",{"data-testid":"selected-times",className:"mt-4",children:[(0,n.jsxs)("h3",{className:"text-md font-medium mb-2",children:["Selected Times (",v.length,")"]}),v.length>0?(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:v.map(e=>(0,n.jsxs)("span",{"data-testid":"selected-".concat(e),className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[E(e),(0,n.jsx)("button",{onClick:()=>w(e,!1),className:"ml-2 text-blue-600 hover:text-blue-800","aria-label":"Remove ".concat(E(e)),children:"\xd7"})]},e))}):(0,n.jsx)("p",{className:"text-gray-500 text-sm",children:"No times selected"})]}),(0,n.jsx)("button",{onClick:()=>{if(v.length<2)return void y("Please select at least 2 handoff times to sort.");g(!0),y(null)},disabled:v.length<2||p,"data-testid":"start-sorting",className:"\n            w-full py-3 px-4 rounded-md font-medium transition-colors\n            ".concat(v.length>=2&&!p?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n          "),children:p?"Saving...":"Start Sorting Preferences"}),v.length<2&&(0,n.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"Select at least 2 handoff times to enable sorting"})]})]})}function m(){let[e,t]=(0,s.useState)("weekday"),[r,a]=(0,s.useState)([]),[d,c]=(0,s.useState)(!0),[i,m]=(0,s.useState)(null),u="demo-relationship-123",h="demo-user-123",p=(0,l.k)();(0,s.useEffect)(()=>{f()},[]);let f=async()=>{try{c(!0);let{data:e,error:t}=await p.from("handoff_time_preferences").select("*").eq("relationshipId",u).eq("userId",h);t?(console.warn("Could not load preferences (demo mode):",t),a([])):a(e||[])}catch(e){console.warn("Could not load preferences (demo mode):",e),a([])}finally{c(!1)}},x=e=>r.filter(t=>t.dayType===e);return d?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading your preferences..."})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto px-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Handoff Time Preferences"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Set your preferred handoff times for weekdays and weekends to help with custody scheduling."})]}),i&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:(0,n.jsx)("p",{className:"text-red-800",children:i})}),(0,n.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg mb-8",children:[(0,n.jsxs)("button",{onClick:()=>t("weekday"),className:"\n                flex-1 py-2 px-4 rounded-md font-medium transition-colors\n                ".concat("weekday"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900","\n              "),"data-testid":"weekday-tab",children:["Weekdays",x("weekday").length>0&&(0,n.jsx)("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full",children:x("weekday").length})]}),(0,n.jsxs)("button",{onClick:()=>t("weekend"),className:"\n                flex-1 py-2 px-4 rounded-md font-medium transition-colors\n                ".concat("weekend"===e?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900","\n              "),"data-testid":"weekend-tab",children:["Weekends",x("weekend").length>0&&(0,n.jsx)("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-blue-100 bg-blue-600 rounded-full",children:x("weekend").length})]})]}),(0,n.jsx)("div",{"data-testid":"".concat(e,"-content"),children:(0,n.jsx)(o,{relationshipId:u,currentUserId:h,dayType:e,existingPreferences:x(e),onPreferencesUpdated:t=>{a(r=>[...r.filter(t=>t.dayType!==e),...t])}})})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[277,982,804,796,110,441,684,358],()=>t(4778)),_N_E=e.O()}]);