(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[259],{2215:(e,r,s)=>{"use strict";s.d(r,{N:()=>i});var t=s(2099);class a{async seedDemoDataForUser(e){console.log("Seeding demo data for user:",e);try{let{error:r}=await this.supabase.rpc("seed_demo_data_for_user",{user_id:e});if(r)throw console.error("Error seeding demo data:",r),Error("Failed to seed demo data");console.log("Demo data seeded successfully for user:",e)}catch(e){throw console.error("Error in seedDemoDataForUser:",e),e}}async clearDemoDataForUser(e){console.log("Clearing demo data for user:",e);try{let{error:r}=await this.supabase.rpc("clear_demo_data_for_user",{user_id:e});if(r)throw console.error("Error clearing demo data:",r),Error("Failed to clear demo data");console.log("Demo data cleared successfully for user:",e)}catch(e){throw console.error("Error in clearDemoDataForUser:",e),e}}async getDemoPreferences(e){console.log("Getting demo preferences for user:",e);try{let{data:r,error:s}=await this.supabase.from("co_parent_relationships").select("id").or("parent_a_id.eq.".concat(e,",parent_b_id.eq.").concat(e)).eq("is_demo",!0).limit(1);if(s)throw console.error("Error getting demo relationship:",s),s;if(!r||0===r.length)return console.log("No demo relationship found, returning empty preferences"),[];let t=r[0].id,{data:a,error:i}=await this.supabase.from("day_preferences").select("day_of_week, priority").eq("relationship_id",t).eq("parent_id",e).eq("is_demo",!0).order("priority");if(i)throw console.error("Error getting demo preferences:",i),i;if(!a||0===a.length)return[];let o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=["Family time and relaxation","Work schedule flexibility","Midweek coordination","School activities","Planning ahead","Weekend preparation","Recreation and activities"],d=a.map((e,r)=>({id:"day-".concat(e.day_of_week),label:o[e.day_of_week],description:n[e.day_of_week],priority:e.priority}));return console.log("Retrieved demo preferences:",d),d}catch(e){throw console.error("Error in getDemoPreferences:",e),e}}async saveDemoPreferences(e,r){console.log("Saving demo preferences for user:",e,r);try{let s=await this.getDemoRelationshipId(e);if(!s)throw Error("No demo relationship found for user");let{error:t}=await this.supabase.from("day_preferences").delete().eq("relationship_id",s).eq("parent_id",e).eq("is_demo",!0);if(t)throw console.error("Error deleting existing preferences:",t),t;let a=r.map((r,t)=>{let a=parseInt(r.id.replace("day-",""));return{relationship_id:s,parent_id:e,day_of_week:a,priority:t+1,is_demo:!0}}),{error:i}=await this.supabase.from("day_preferences").insert(a);if(i)throw console.error("Error inserting preferences:",i),i;console.log("Demo preferences saved successfully")}catch(e){throw console.error("Error in saveDemoPreferences:",e),e}}async getDemoRelationshipId(e){try{let{data:r,error:s}=await this.supabase.from("co_parent_relationships").select("id").or("parent_a_id.eq.".concat(e,",parent_b_id.eq.").concat(e)).eq("is_demo",!0).limit(1);if(s)return console.error("Error getting demo relationship:",s),null;return r&&r.length>0?r[0].id:null}catch(e){return console.error("Error in getDemoRelationshipId:",e),null}}constructor(){this.supabase=(0,t.k)()}}let i=new a},3538:(e,r,s)=>{Promise.resolve().then(s.bind(s,4302))},4302:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>c});var t=s(5155),a=s(2115),i=s(3715),o=s(5034),n=s(3006),d=s(4899),l=s(2215);function c(){let{isGuest:e,isAuthenticated:r,user:s}=(0,i.As)(),[c,m]=(0,a.useState)([]),[h,u]=(0,a.useState)(!1),[p,y]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),[x,b]=(0,a.useState)(null),[w,v]=(0,a.useState)([]);(0,a.useEffect)(()=>{e&&s&&j()},[e,s]);let j=async()=>{if(s){g(!0),b(null);try{await l.N.seedDemoDataForUser(s.id);let e=await l.N.getDemoPreferences(s.id);e.length>0?(m(e),u(!0),y(!1)):(v([{id:"day-0",label:"Sunday",description:"Family time and relaxation"},{id:"day-1",label:"Monday",description:"Work schedule flexibility"},{id:"day-2",label:"Tuesday",description:"Midweek coordination"},{id:"day-3",label:"Wednesday",description:"School activities"},{id:"day-4",label:"Thursday",description:"Planning ahead"},{id:"day-5",label:"Friday",description:"Weekend preparation"},{id:"day-6",label:"Saturday",description:"Recreation and activities"}]),y(!0))}catch(e){console.error("Error initializing demo data:",e),b("Failed to load demo data. Please try again.")}finally{g(!1)}}},N=async e=>{if(s){g(!0),b(null);try{await l.N.saveDemoPreferences(s.id,e),m(e),u(!0),y(!1),d.B.updateGuestPreferences("days",e),d.B.saveGuestInteraction("preference_sort",{type:"priority_sorting",items:e.map(e=>({id:e.id,label:e.label})),completedAt:new Date().toISOString()}),console.log("Sorting completed and saved to database:",e)}catch(e){console.error("Error saving demo preferences:",e),b("Failed to save preferences. Please try again.")}finally{g(!1)}}},_=async()=>{if(s){g(!0),b(null);try{await l.N.clearDemoDataForUser(s.id),m([]),u(!1),y(!1),await j(),d.B.updateGuestPreferences("days",[]),d.B.saveGuestInteraction("demo_action",{action:"demo_reset",demoType:"preferences"})}catch(e){console.error("Error resetting demo:",e),b("Failed to reset demo. Please try again.")}finally{g(!1)}}},S=()=>({relationshipId:"rel-123",currentUserId:(null==s?void 0:s.id)||"user-123",existingPreferences:[],otherParentPreferences:[]});return(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Preferences"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Set your preferences for scheduling and co-parenting arrangements."}),e&&(0,t.jsxs)("div",{className:"mt-3 inline-flex items-center bg-blue-50 border border-blue-200 rounded-lg px-4 py-2",children:[(0,t.jsx)("div",{className:"text-blue-600 mr-2",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),(0,t.jsx)("span",{className:"text-sm text-blue-800",children:"Demo Mode: Try our priority sorting system to see how it helps organize your life!"})]})]}),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("section",{children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Day Preferences"}),x&&(0,t.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-red-800",children:x})}),f&&(0,t.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-blue-800",children:"Loading demo data..."})}),e?(0,t.jsx)("div",{className:"space-y-6",children:!h&&p&&w.length>0?(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:(0,t.jsx)(n.S,{items:w,onSortComplete:N,title:"Prioritize Your Day Preferences",description:"We'll show you pairs of days. Choose which day is more important for scheduling with your child."})}):h?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold text-green-600 mb-2",children:"âœ“ Your Day Preferences Are Set!"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Here's how you've prioritized your preferred days. This ranking helps us suggest better scheduling options for you."})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,t.jsx)("h4",{className:"text-xl font-semibold mb-4",children:"Your Day Priority Ranking:"}),(0,t.jsx)("div",{className:"space-y-3",children:c.map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-semibold mr-4",children:r+1}),(0,t.jsxs)("div",{className:"flex-grow",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.label}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]},e.id))})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("button",{onClick:_,disabled:f,className:"inline-flex items-center px-6 py-3 border border-gray-300 shadow-sm text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:f?"Resetting...":"Try Different Order"})})]}):(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ready to Set Your Day Preferences?"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Our interactive sorting system helps you prioritize which days work best for you."}),(0,t.jsx)("button",{onClick:()=>y(!0),disabled:f,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:f?"Loading...":"Start Day Priority Sorting"})]})}):(0,t.jsx)(o.DayPreferenceSorting,{relationshipId:S().relationshipId,currentUserId:S().currentUserId,existingPreferences:S().existingPreferences,otherParentPreferences:S().otherParentPreferences})]}),(0,t.jsxs)("section",{"data-testid":"date-preferences",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Date Preferences"}),(0,t.jsx)("div",{className:"bg-gray-50 p-6 rounded-lg",children:(0,t.jsx)("p",{className:"text-gray-600",children:e?"This feature will be available after completing the priority sorting above.":"Date preferences coming soon..."})})]})]})]})})}},5034:(e,r,s)=>{"use strict";s.d(r,{DayPreferenceSorting:()=>d});var t=s(5155),a=s(2115),i=s(3006),o=s(2099);let n=[{id:"0",label:"Sunday",description:"Weekend day"},{id:"1",label:"Monday",description:"Start of school week"},{id:"2",label:"Tuesday",description:"School day"},{id:"3",label:"Wednesday",description:"Mid-week"},{id:"4",label:"Thursday",description:"School day"},{id:"5",label:"Friday",description:"End of school week"},{id:"6",label:"Saturday",description:"Weekend day"}];function d(e){let{relationshipId:r,currentUserId:s,existingPreferences:d=[],otherParentPreferences:l=[]}=e,[c,m]=(0,a.useState)(n),[h,u]=(0,a.useState)(!1),[p,y]=(0,a.useState)(null),[f,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(d.length>0){let e=[...d].sort((e,r)=>e.priority-r.priority),r=e.map(e=>n.find(r=>parseInt(r.id)===e.dayOfWeek)),s=new Set(e.map(e=>e.dayOfWeek.toString()));m([...r,...n.filter(e=>!s.has(e.id))])}},[d]);let x=async e=>{u(!0),y(null);try{let t=(0,o.k)(),a=e.map((e,t)=>({relationshipId:r,userId:s,dayOfWeek:parseInt(e.id),priority:t+1})),{error:i}=await t.from("day_preferences").upsert(a);if(i)throw i;m(e)}catch(e){y("Error saving preferences. Please try again."),console.error("Error saving day preferences:",e)}finally{u(!1)}};return(0,t.jsxs)("div",{className:"space-y-6","data-testid":"day-preferences",children:[l.length>0&&(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Other Parent's Preferences"}),(0,t.jsx)("button",{onClick:()=>g(!f),className:"text-blue-600 hover:text-blue-800 text-sm",children:f?"Hide":"Show"})]}),f&&(0,t.jsx)("div",{className:"space-y-2",children:l.sort((e,r)=>e.priority-r.priority).map((e,r)=>{let s=n.find(r=>parseInt(r.id)===e.dayOfWeek);return(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsx)("span",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-xs mr-3",children:r+1}),(0,t.jsx)("span",{children:null==s?void 0:s.label})]},e.dayOfWeek)})})]}),p&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-red-800",children:p})}),h&&(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("p",{className:"text-gray-600",children:"Saving your preferences..."})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("button",{"data-testid":"sort-day-preferences",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>{let e=document.querySelector('[data-testid="sorting-component"]');e&&e.scrollIntoView({behavior:"smooth"})},children:"Start Sorting Day Preferences"})}),(0,t.jsx)(i.S,{items:c,onSortComplete:x,title:"Sort Your Day Preferences",description:"Rank the days of the week by your preference to have your child. Most preferred days will be ranked higher."})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[982,277,804,715,796,899,6,441,684,358],()=>r(3538)),_N_E=e.O()}]);